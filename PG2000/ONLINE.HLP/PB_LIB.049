$ Online Hilfe fuer die System 2000 Profibus Fubs -> Zeile 1236
%%
1,0:001
%%
.1
    Funktionen der PROFIBUS-Library

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º ACHTUNG: Da die PROFIBUS-Library AVT-Funktionen enth„lt, k”nnen die       º
  º          Funktionen der Library nur verwendet werden, wenn das Library-   º
  º          Runtime-Modul (B&R-Modul PB_LIB.BR) im nullspannungssicheren     º
  º          Speicher (Anwender-ROM) der Steuerung vorhanden ist!             º
  º          Nach dem šbertragen des Library-Runtime-Moduls in den null-      º
  º          spannungssicheren Speicher muá ein KALTSTART (frher "TOTALINIT" º
  º          genannt) durchgefhrt werden.                                    º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼










                                     @002[ Fortsetzung ]               @999[ HILFE beenden ]
.2
    Funktionen der PROFIBUS-Library (Fortsetzung)

    Mit den Funktionen der PROFIBUS-Library k”nnen Daten von einer PROFIBUS-
    Station gelesen bzw. Daten an eine PROFIBUS-Station gesendet werden.
    Nach dem Importieren der PROFIBUS-Library stehen Ihnen folgende Funktions-
    gruppen zur Verfgung:

    @020[< Initialisierung       >] PROFIBUS-Initialisierung
    @030[< Verbindungsmanagement >] Verbindungsaufbau/-abbau
    @070[< Variablendienste      >] Lesen/Schreiben von Variablen
    @240[< OV-Management         >] Zugriff auf das Objektverzeichnis
    @270[< Receive               >] Telegramme empfangen
    @280[< Send                  >] Telegramme senden
    @400[< Information Report    >] Senden von Daten-Telegrammen
    @410[< Status senden         >] Senden von Status-Telegrammen
    @420[< Download-Dienste      >] šbertragen von B&R-Modulen
    @440[< Event-Dienste         >] Event-Management-Dienste
    @470[< Dienste fr C110      >] Funktionen fr das C110 Slave-Controllermodul

    Beachten Sie bitte die @560[Hinweise] zu den PROFIBUS-Funktionen!

                                       @550[ ANHANG ]                      @001[ šbersicht ]
.20
    PROFIBUS-Library - Initialisierung

    Die Funktionsgruppe Initialisierung enth„lt eine Funktion fr die PROFIBUS-
    Initialisierung.

    @021[PBinit] PROFIBUS-Initialisierung















                                                                     @001[ šbersicht ]
.21
    PBinit - PROFIBUS-Initialisierung

    @022[PBinit](enable,srv_cnt,memsize,par_ptr,error_nr,memadr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @025[srv_cnt   ]: WORD          Anzahl der zu reservierenden Puffer.
    ->  memsize   : LONG          Gr”áe des Speicherbereichs, der im DPR
                                  (Dual Ported RAM) des Netzwerk-Controllers fr
                                  den Anwender reserviert werden soll (siehe
                                  Funktion @110[PBrdDPR] und @170[PBwrDPR]).
    ->  par_ptr   : LONG          Dieser Parameter hat derzeit noch keine
                                  Funktion und muá daher immer mit dem Wert 0
                                  belegt werden!
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  memadr    : LONG          Adresse des Speicherbereichs (im DPR des
                                  Netzwerk-Controllers), der fr den Anwender
                                  zur Verfgung steht.


                                     @022[ Fortsetzung ]                   @001[ šbersicht ]
.22
    PBinit - PROFIBUS-Initialisierung (Fortsetzung)

    Die Funktion PBinit() initialisiert im DPR des Netzwerk-Controllers alle
    notwendigen Strukturen fr den Betrieb der PROFIBUS-Funktionsbl”cke.

    Anmerkungen:
    - Die Funktion PBinit() darf nur in Initialisierungs-Unterprogrammen
      (INIT-UPs) der zyklischen Tasks aufgerufen werden.
    - Auáerdem muá sichergestellt sein, daá vor dem Aufruf der Funktion
      PBinit() keine andere Funktion der PROFIBUS-Library aktiviert wird.
    - Es muá sichergestellt werden, daá die Funktion PBinit() nach jedem WARM-
      (alte Bezeichnung: INIT) bzw. KALTSTART (alte Bezeichnung: TOTALINIT)
      nur einmal aufgerufen wird. So kommt es zum Beispiel bei einem erneuten
      Download einer Task, die im INIT-UP die Funktion PBinit() aufruft, zu
      einem Fehlverhalten.
    - Die Anzahl der @025[reservierten Puffer] muá gr”áer oder gleich der Anzahl der
      verwendeten PROFIBUS-Funktionsbl”cke sein.




                                   @020[ Initialisierung ]                 @001[ šbersicht ]
.25
    PBinit - PROFIBUS-Initialisierung (Fortsetzung)

    -> Parameter <srv_cnt   >: WORD

    Anzahl der zu reservierenden Puffer.
    Beim Aufruf der Funktion PBinit() wird im DPR des Netzwerk-Controllers die
    angegebene Anzahl von Puffern reserviert.
    Werden von einem PROFIBUS-Funktionsblock Nachrichten gesendet, ben”tigt er
    fr diese einen Zwischenspeicher (Puffer), bis der Dienst vollst„ndig be-
    antwortet wurde. D.h. fr jeden verwendeten PROFIBUS-Funktionsblock (auáer
    @031[PBinfoKR], @040[PBstatKR] und @050[PBsyncKR]) muá ein eigener Puffer im DPR des Netzwerk-
    Controllers reserviert werden.
    Die Anzahl der reservierten Puffer entspricht also der m”glichen Anzahl von
    PROFIBUS-Diensten und muá daher gr”áer oder gleich der Gesamtanzahl der
    PROFIBUS-Funktionsblock-Aktivierungen sein.
    Der ben”tigte Puffer wird bei der ersten Aktivierung des Funktionsblocks
    angew„hlt. Bei weiteren Aktivierungen dieses Funktionsblocks wird dann immer
    auf denselben Puffer zugegriffen.



                                       @021[ PBinit ]                      @001[ šbersicht ]
.30
    PROFIBUS-Library - Verbindungsmanagement

    Mit den Funktionen der Gruppe Verbindungsmanagement k”nnen Sie eine Ver-
    bindung auf- oder abbauen, den Status einer Verbindung ermitteln, usw.

    @031[PBinfoKR] Verbindungsinformation abfragen
    @040[PBstatKR] Verbindungsstatus abfragen
    @050[PBsyncKR] Sync-Z„hler einer Verbindung auslesen
    @060[PBautoKR] Verbindung auf- oder abbauen












                                                                     @001[ šbersicht ]
.31
    PBinfoKR - Verbindungsinformation abfragen

    @032[PBinfoKR](enable,adr(name),adr(info_ptr),error_nr,kr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @035[name      ]: BYTE (FELD)   Symbolischer Name der gewnschten Verbindung
                                  (aus der Kommunikationsbeziehungsliste) als
                                  String. Der String kann auf zwei verschiedene
                                  Arten angegeben werden:
                                  adr(name)  Adresse der BYTE-Feldvariable, die
                                             den String enth„lt.
                                  "name"     Konstanter String (muá in Anfhr-
                                             ungszeichen angegeben werden!).
    <-> @036[info_ptr  ]: KR-Struktur   Struktur, in der Zusatzinformationen zur ge-
                                  wnschten Verbindung abgelegt werden. Wird
                                  fr adr(info_ptr) der Wert 0 bergeben, werden
                                  keine Zusatzinformationen zu der Verbindung
                                  geliefert.

                                     @032[ Fortsetzung ]                   @001[ šbersicht ]
.32
    PBinfoKR - Verbindungsinformation abfragen (Fortsetzung)

    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  kr        : WORD          Kommunikationsreferenz (logische Verbin-
                                  dungsnummer) fr den angegebenen symbolischen
                                  Namen. Die logische Verbindungsnummer wird fr
                                  viele andere Funktionen der PROFIBUS-Library
                                  ben”tigt.

    Bei Angabe des symbolischen Namens der gewnschten Verbindung k”nnen mit
    dieser Funktion die zugeh”rige Kommunikationsreferenz (logische Verbindungs-
    nummer) sowie weitere Informationen zur Verbindung ermittelt werden.
    Dieser Dienst wird sofort beantwortet. Nach dem Aufruf des Funktionsblocks
    liegt das Ergebnis vor. Der Dienst ben”tigt keinen Puffer.







                                @030[ Verbindungsmanagement ]              @001[ šbersicht ]
.35
    PBinfoKR - Verbindungsinformation abfragen (Fortsetzung)

    -> Parameter <name      >: BYTE (FELD)

    Symbolischer Name der gewnschten Verbindung. Der symbolische Name einer
    Verbindung ist in der Kommunikationsbeziehungsliste (KBL) definiert (siehe
    Parameter [Name] der Kommunikationsbeziehungsliste).
    Detaillierte Informationen zur Kommunikationsbeziehungsliste finden Sie im
    "PROFIBUS Anwenderhandbuch".












                                      @031[ PBinfoKR ]                     @001[ šbersicht ]
.36
    PBinfoKR - Verbindungsinformation abfragen (Fortsetzung)

    <-> Parameter <info_ptr  >: KR-Struktur

    Struktur, in der Zusatzinformationen zur gewnschten Verbindung abgelegt
    werden. Elemente der Struktur "KR":

    src_adr    : BYTE    Adresse der eigenen (lokalen) Station.
    dest_adr   : BYTE    Adresse der Zielstation.
    src_kanal  : BYTE    Kommunikationskanal auf der lokalen Station
                         (Source-SAP).
    dest_kanal : BYTE    Kommunikationskanal auf der Zielstation
                         (Destination-SAP).
    maxSCC     : BYTE    Maximalanzahl der parallelen Confirmed Dienste.
    maxSAC     : BYTE    Maximalanzahl der parallelen Unconfirmed Dienste.
    spdu_len   : BYTE    Gr”áe des Sendepuffers.
    rpdu_len   : BYTE    Gr”áe des Empfangspuffers.
    device_nr  : BYTE    Device-Nummer
    reserve    : BYTE    Reserviert


                                      @031[ PBinfoKR ]                     @001[ šbersicht ]
.40
    PBstatKR - Verbindungsstatus abfragen

    @041[PBstatKR](enable,kr,error_nr,status)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer). Gibt die Verbindung, deren Status
                                  bestimmt werden soll, an. Siehe Funktionsblock
                                  @031[PBinfoKR].
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  status    : BYTE          Aktueller Status der Verbindung:
                                  $00 ... Verbindung abgebaut.
                                  $55 ... Verbindung wird gerade aufgebaut.
                                  $FF ... Verbindung ist aufgebaut.

    Mit dieser Funktion k”nnen Sie den aktuellen Status der angegebenen
    Verbindung ermitteln.


                                     @041[ Fortsetzung ]                   @001[ šbersicht ]
.41
    PBstatKR - Verbindungsstatus abfragen (Fortsetzung)

    Dieser Dienst wird sofort beantwortet. Nach dem Aufruf des Funktionsblocks
    liegt das Ergebnis vor. Der Dienst ben”tigt keinen Puffer.

    Anmerkung:
    Variablendienste, Download-Dienste, etc. sind nur bei aufgebauten Verbin-
    dungen ("status" = $FF) m”glich!













                                @030[ Verbindungsmanagement ]              @001[ šbersicht ]
.50
    PBsyncKR - Sync-Z„hler einer Verbindung auslesen

    @051[PBsyncKR](enable,kr,dir,error_nr,count)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Verbindung an, deren Sync-Z„hler ausge-
                                  lesen werden soll.
    ->  dir       : BYTE          0 ... Empfangs-Sync-Z„hler auslesen
                                  1 ... Sende-Sync-Z„hler auslesen
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  count     : BYTE          Aktueller Z„hlerstand des Empfangs-Sync-
                                  Z„hlers (dir = 0) bzw. des Sende-Sync-Z„hlers
                                  (dir = 1).

    Fr jede Verbindung ist am Controller ein eigener Sende-Sync-Z„hler und ein
    eigener Empfangs-Sync-Z„hler angelegt.

                                     @051[ Fortsetzung ]                   @001[ šbersicht ]
.51
    PBsyncKR - Sync-Z„hler einer Verbindung auslesen (Fortsetzung)

    Der Sende-Sync-Z„hler wird bei jedem Senden, der Empfangs-Sync-Z„hler bei
    jedem Empfangen eines Telegramms erh”ht. Mit der Funktion PBsyncKR() kann
    der aktuelle Wert des Sende-Sync-Z„hlers bzw. des Empfangs-Sync-Z„hlers der
    angegebenen Verbindung ermittelt werden.
    Dieser Dienst wird sofort beantwortet. Nach dem Aufruf des Funktionsblocks
    liegt das Ergebnis vor. Der Dienst ben”tigt keinen Puffer.

    Anmerkungen:
    - Der Dienst kann auch auf Verbindungen, die nicht fr Broadcast
      konfiguriert sind, angewendet werden.
    - Dabei ist zu beachten, daá nicht nur Datentelegramme (z.B. Read/Write)
      zu einer Erh”hung des Sync-Z„hlers fhren, sondern auch Netzwerk-interne
      Telegramme (z.B. Telegramme zur Verbindungsberwachung)!






                                     @052[ Fortsetzung ]                   @001[ šbersicht ]
.52
    PBsyncKR - Sync-Z„hler einer Verbindung auslesen (Fortsetzung)

    Anwendungsbeispiel (Zeitsynchronisation):
    Eine Station sendet einen Broadcast-Dienst an alle anderen Stationen aus
    (Funktion @401[PBirepI]). Auf jeder Station wird unmittelbar nach Empfang des
    Telegramms der Sync-Z„hler fr den Empfang erh”ht. Dies passiert auf allen
    Stationen nahezu gleichzeitig. Auf jeder Station kann dieser Sync-Z„hler
    nun zyklisch abgetastet werden. Je nach Aufl”sung der Abtastung kann auf
    den einzelnen Stationen eine entsprechend genaue Zeitsynchronisierung
    durchgefhrt werden. Die sendende Station kann ebenfalls durch Abfrage des
    Sende-Sync-Z„hlers aufsynchronisiert werden (Unmittelbar nach Senden des
    Telegramms wird der Sende-Sync-Z„hler erh”ht).









                                @030[ Verbindungsmanagement ]              @001[ šbersicht ]
.60
    PBautoKR - Verbindung auf- oder abbauen

    @061[PBautoKR](enable,kr,onoff,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Verbindung an, die auf- bzw. abgebaut
                                  werden soll.
    ->  onoff     : BYTE          1 ... Verbindung aufbauen.
                                  0 ... Verbindung abbauen.
    <-  ready     : BIT           Dienst wurde fehlerfrei abgewickelt.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit dieser Funktion wird die angegebene Verbindung auf- bzw. abgebaut. Wenn
    der Eingangsparameter "onoff" = 1 ist, wird die Verbindung aufgebaut. Wird
    diese Verbindung durch eine St”rung am Netz (z.B. Ziehen des Bussteckers)
    abgebaut, wird in Folge automatisch (vom Netzwerk-Controller) versucht,
    diese wieder aufzubauen.
                                     @061[ Fortsetzung ]                   @001[ šbersicht ]
.61
    PBautoKR - Verbindung auf- oder abbauen (Fortsetzung)

    Ist die Zielstation, zu der die Verbindung aufgebaut werden soll, nicht
    vorhanden, wird in  parametrierbaren Zeitintervallen (Parameter vb_ci der
    KBL, siehe "PROFIBUS Anwenderhandbuch") vom Netzwerk-Controller ein
    Verbindungsaufbauversuch durchgefhrt (bis sich die Zielstation meldet).
    Dieser automatische Aufbauversuch kann durch einen neuerlichen Aufruf der
    Funktion PBautoKR() mit "onoff" = 0 ausgeschaltet werden.
    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.










                                     @062[ Fortsetzung ]                   @001[ šbersicht ]
.62
    PBautoKR - Verbindung auf- oder abbauen (Fortsetzung)

    Anmerkungen:
    - Der Anwender muá fr eine Verbindung nur einmal die Funktion PBautoKR()
      ("onoff" = 1) aufrufen, anschlieáend wird die Verbindung vom Netzwerk-
      Controller selbst„ndig aufrecht erhalten.
    - Ist eine Verbindung bereits auf "onoff" = 1 geschaltet, wird ein neuer-
      licher Aufruf von PBautoKR() mit "onoff" = 1 mit einem Fehler abgewiesen.
    - Wenn der Ausgangsparameter "ready" = 1 ist, bedeutet das nicht, daá die
      Verbindung bereits aufgebaut ist, sondern lediglich, daá die Umschaltung
      auf den automatischen Verbindungsaufbau ohne Fehler akzeptiert wurde.
    - Ob die Verbindung auf- bzw. abgebaut ist, kann mit Hilfe der Funktion
      @040[PBstatKR] ermittelt werden.
    - Ist eine Verbindung bereits in der Konfiguration auf automatischen
      Verbindungsaufbau projektiert (Parameter vb_info der KBL, siehe
      "PROFIBUS Anwenderhandbuch"), kann der Automatik-Mode durch diese
      Funktion nicht ausgeschaltet werden!




                                @030[ Verbindungsmanagement ]              @001[ šbersicht ]
.70
    PROFIBUS-Library - Variablendienste

    Die Funktionsgruppe Variablendienste enth„lt Funktionen zum Lesen und
    Beschreiben von Variablen einer anderen PROFIBUS-Station (siehe @230[Beispiel]).

    @071[PBreadI ] Variable/Variablenliste ber Index lesen
    @080[PBreadN ] Variable/Variablenliste ber Name lesen
    @090[PBreadX ] Variable extended (l„nger als Frame) lesen
    @100[PBreadP ] Variable ber physikalische Adresse lesen
    @110[PBrdDPR ] Speicher aus dem reservierten DPR-Bereich lesen
    @120[PBrdDVL ] Variablen ber dynamische Variablenliste lesen
    @130[PBwriteI] Variable/Variablenliste ber Index beschreiben
    @140[PBwriteN] Variable/Variablenliste ber Name beschreiben
    @150[PBwriteX] Variable extended (l„nger als Frame) beschreiben
    @160[PBwriteP] Variable ber physikalische Adresse beschreiben
    @170[PBwrDPR ] Speicher im reservierten DPR-Bereich beschreiben
    @180[PBwrDVL ] Variablen ber dyn. Variablenliste beschreiben
    @190[PBdefVLI] Variablenliste ber Index definieren
    @200[PBdefVLN] Variablenliste ber Name definieren
    @210[PBdelVLI] Variablenliste ber Index l”schen
    @220[PBdelVLN] Variablenliste ber Name l”schen
                                                                     @001[ šbersicht ]
.71
    PBreadI - Variable/Variablenliste ber Index lesen

    @072[PBreadI](enable,kr,index,subindex,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  @075[index     ]: WORD          PROFIBUS-Index der Variable bzw. der
                                  Variablenliste, die von der Zielstation ge-
                                  lesen werden soll. Der PROFIBUS-Index kann mit
                                  der Funktion @250[PBgetOVN] ermittelt werden.
    ->  @076[subindex  ]: WORD          Subindex der Variable, die von der Zielstation
                                  gelesen werden soll. Beim Lesen von Variablen-
                                  listen muá fr den Subindex immer der Wert 0
                                  angegeben werden.


                                     @072[ Fortsetzung ]                   @001[ šbersicht ]
.72
    PBreadI - Variable/Variablenliste ber Index lesen (Fortsetzung)

    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten abge-
                                  legt werden.
    ->  len       : WORD          Gr”áe des Datenpuffers (data) in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit der Funktion PBreadI() kann eine Variable/Variablenliste von einer
    anderen PROFIBUS-Station gelesen werden. Die Referenzierung der Variable/
    Variablenliste erfolgt ber den (in der Objektbeschreibung angegebenen)
    PROFIBUS-Index dieser Variable/Variablenliste.
    Die gelesenen Daten werden in den angegebenen Datenpuffer ("data") ge-
    schrieben. Der Parameter "len" gibt nicht die L„nge der zu lesenden Daten,
    sondern die Gr”áe des lokalen Datenpuffers an (die L„nge der Daten ist durch
    das Objekt auf der Zielstation vorgegeben). Die Gr”áe des Datenpuffers muá
    gr”áer oder gleich der L„nge der gelesenen Variable sein, sonst wird ein
    Fehler gemeldet!



                                     @073[ Fortsetzung ]                   @001[ šbersicht ]
.73
    PBreadI - Variable/Variablenliste ber Index lesen (Fortsetzung)

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Mit dieser Funktion kann nur auf Variablen/Variablenlisten zugegriffen
    werden, deren L„nge die maximal m”gliche L„nge eines PROFIBUS-Frames
    (ca. 230 Byte) nicht bersteigt! Fr Variablen mit einer L„nge gr”áer
    230 Bytes muá die Funktion PBreadX() verwendet werden.

    Anmerkung:
    Variablenlisten k”nnen mit den Funktionen @190[PBdefVLI] und @200[PBdefVLN] definiert
    werden!







                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.75
    PBreadI - Variable/Variablenliste ber Index lesen (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index der zu lesenden Variable/Variablenliste auf der Zielstation.
    Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden. Diese
    Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Zielstation.
    Das erste Element (Element "Index", Datentyp WORD) dieser Objektbeschreibung
    enth„lt den Index der Variable/Variablenliste.












                                       @071[ PBreadI ]                     @001[ šbersicht ]
.76
    PBreadI - Variable/Variablenliste ber Index lesen (Fortsetzung)

    -> Parameter <subindex  >: WORD

    @540[Subindex] der zu lesenden Variable. Beim Lesen von Variablenlisten muá fr
    den Subindex immer der Wert 0 angegeben werden.















                                       @071[ PBreadI ]                     @001[ šbersicht ]
.80
    PBreadN - Variable/Variablenliste ber Name lesen

    @081[PBreadN](enable,kr,spec_id,adr(name),subindex,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  spec_id   : BYTE          Der Parameter spec_id legt fest, ob fr den
                                  Parameter name der Name einer Variable oder
                                  der Name einer Variablenliste angegeben wird:
                                  1 ... Name einer Prozeávariable.
                                  2 ... Name einer Variablenliste.
    ->  name      : BYTE (FELD)   Name der Prozeávariable (PV-Name) bzw. Name
                                  der Variablenliste auf der Zielstation (als
                                  String).


                                     @081[ Fortsetzung ]                   @001[ šbersicht ]
.81
    PBreadN - Variable/Variablenliste ber Name lesen (Fortsetzung)

                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
    ->  @085[subindex  ]: WORD          Subindex der Variable, die von der Zielstation
                                  gelesen werden soll. Beim Lesen von Variablen-
                                  listen muá fr den Subindex immer der Wert 0
                                  angegeben werden.
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten abge-
                                  legt werden.
    ->  len       : WORD          Gr”áe des Datenpuffers (data) in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).




                                     @082[ Fortsetzung ]                   @001[ šbersicht ]
.82
    PBreadN - Variable/Variablenliste ber Name lesen (Fortsetzung)

    Mit der Funktion PBreadN() kann eine Variable/Variablenliste von einer
    anderen PROFIBUS-Station gelesen werden. Die Referenzierung der Variable/
    Variablenliste erfolgt ber den PV-Namen/Variablenlisten-Namen.
    Die gelesenen Daten werden in den angegebenen Datenpuffer ("data") ge-
    schrieben. Der Parameter "len" gibt nicht die L„nge der zu lesenden Daten,
    sondern die Gr”áe des lokalen Datenpuffers an (die L„nge der Daten ist durch
    das Objekt auf der Zielstation vorgegeben). Die Gr”áe des Datenpuffers muá
    gr”áer oder gleich der L„nge der gelesenen Variable sein, sonst wird ein
    Fehler gemeldet!
    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Mit dieser Funktion kann nur auf Variablen/Variablenlisten zugegriffen
    werden, deren L„nge die maximal m”gliche L„nge eines PROFIBUS-Frames
    (ca. 230 Byte) nicht bersteigt! Fr Variablen mit einer L„nge gr”áer
    230 Bytes muá die Funktion @090[PBreadX] verwendet werden.


                                     @083[ Fortsetzung ]                   @001[ šbersicht ]
.83
    PBreadN - Variable/Variablenliste ber Name lesen (Fortsetzung)

    Anmerkung:
    Variablenlisten k”nnen mit den Funktionen @190[PBdefVLI] und @200[PBdefVLN] definiert
    werden!

    Der Zugriff auf Variablen ber ihren PV-Namen ist einfach, aber wesentlich
    langsamer als der Zugriff ber den PROFIBUS-Index mit der Funktion @071[PBreadI].













                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.85
    PBreadN - Variable/Variablenliste ber Name lesen (Fortsetzung)

    -> Parameter <subindex  >: WORD

    @540[Subindex] der zu lesenden Variable. Beim Lesen von Variablenlisten muá fr
    den Subindex immer der Wert 0 angegeben werden.















                                       @080[ PBreadN ]                     @001[ šbersicht ]
.90
    PBreadX - Variable extended (l„nger als Frame) lesen

    @091[PBreadX](enable,kr,offset,adr(name),adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  @095[offset    ]: WORD          Offset (bezogen auf die Adresse der Variable),
                                  ab dem gelesen wird.
    ->  name      : BYTE (FELD)   Name der Prozeávariable (PV-Name) auf der
                                  Zielstation (als String).
                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:




                                     @091[ Fortsetzung ]                   @001[ šbersicht ]
.91
    PBreadX - Variable extended (l„nger als Frame) lesen (Fortsetzung)

                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten abge-
                                  legt werden.
    ->  len       : WORD          L„nge der zu lesenden Daten in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Diese Funktion erm”glicht das Lesen von Variablen, deren L„nge die maximal
    m”gliche L„nge eines PROFIBUS-Frames (ca. 230 Byte) berschreitet. Um die
    gesamte Variable zu lesen, sind daher mehrere Zugriffe notwendig. Fr den
    Anwender ist diese Problematik aber ohne Bedeutung, da die Zugriffe von der
    Funktion selbst„ndig durchgefhrt werden und nach erfolgreichem Abschluá der
    Dienst wie ein einzelnes Read best„tigt wird.
    Die gelesenen Daten werden in den angegebenen Datenpuffer ("data") ge-
    schrieben. Der Parameter "len" gibt die L„nge der zu lesenden Daten an.

                                     @092[ Fortsetzung ]                   @001[ šbersicht ]
.92
    PBreadX - Variable extended (l„nger als Frame) lesen (Fortsetzung)

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Interner Ablauf der Funktion:
    - Als erstes wird mit einem Get-OV-Dienst ber den PV-Namen die Objekt-
      beschreibung der gewnschten Variable angefordert. Daraus l„át sich die
      physikalische Adresse der Variable bestimmen. 
    - Anschlieáend werden beginnend ab dieser physikalischen Adresse (plus dem
      angegebenen Offset "offset") solange physikalische Read-Dienste abgesetzt,
      bis Daten der L„nge "len" in den mit dem Parameter "data" angegebenen
      Bereich gelesen wurden.
    - Der Get-OV-Dienst wird nur bei der erstmaligen Dienstanforderung ausge-
      fhrt. ndert sich der PV-Name und die logische Verbindungsnummer bei
      weiteren Aufrufen nicht mehr, werden direkt die physikalischen Read-
      Dienste abgewickelt.



                                     @093[ Fortsetzung ]                   @001[ šbersicht ]
.93
    PBreadX - Variable extended (l„nger als Frame) lesen (Fortsetzung)

    Anmerkung:
    Die Funktion PBreadX() ist kein Standard-PROFIBUS-Dienst, d.h. diese
    Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten ver-
    wendet werden!















                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.95
    PBreadX - Variable extended (l„nger als Frame) lesen (Fortsetzung)

    -> Parameter <offset    >: WORD

    Der Parameter "offset" ist beim Zugriff auf Elemente von Feldern (Arrays)
    oder Strukturen von Bedeutung. Dieser Parameter gibt an, ab welchem Offset
    (in Byte) die Elemente einer Struktur- oder Feldvariable gelesen werden.
    Um das gesamte Feld bzw. die ganze Struktur zu lesen, muá fr den Parameter
    "offset" der Wert 0 angegeben werden!
    Soll zum Beispiel eine Feldvariable (Datentyp LONG, L„nge 60) ab dem dritten
    Element (Element mit Index 2) gelesen werden, so muá fr den Parameter
    "offset" der Wert 8 (2 LONG = 8 Byte) angegeben werden!









                                       @090[ PBreadX ]                     @001[ šbersicht ]
.100
    PBreadP - Variable ber physikalische Adresse lesen

    @101[PBreadP](enable,kr,phy_adr,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  @105[phy_adr   ]: LONG          Physikalische Adresse der Variable auf der
                                  Zielstation. 
                                  Die physikalische Adresse kann mit der
                                  Funktion @250[PBgetOVN] ermittelt werden.
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten abge-
                                  legt werden.




                                     @101[ Fortsetzung ]                   @001[ šbersicht ]
.101
    PBreadP - Variable ber physikalische Adresse lesen (Fortsetzung)

    ->  len       : WORD          L„nge der zu lesenden Daten in Byte. šber-
                                  schreitet die L„nge der zu lesenden Daten die
                                  maximal m”gliche Gr”áe eines PROFIBUS-Frames
                                  (ca. 230 Byte), so werden die Daten auto-
                                  matisch auf mehrere Transfers aufgeteilt.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit der Funktion PBreadP() kann eine Variable von einer anderen PROFIBUS-
    Station gelesen werden. Die Referenzierung der Variable erfolgt ber die in
    der Objektbeschreibung angegebene physikalische Adresse dieser Variable.
    Die gelesenen Daten werden in den angegebenen Datenpuffer ("data") ge-
    schrieben. Der Parameter "len" gibt die L„nge der zu lesenden Daten an.
    Auf der Zielstation findet keine Prfung der L„nge statt.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.105
    PBreadP - Variable ber physikalische Adresse lesen (Fortsetzung)

    -> Parameter <phy_adr   >: LONG

    Physikalische Adresse der zu lesenden Variable auf der Zielstation.
    Die physikalische Adresse kann ber die Funktion PBgetOVN ermittelt werden.
    Diese Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Ziel-
    station. Das Element "Local-Address" (Datentyp LONG) dieser Objekt-
    beschreibung enth„lt die physikalische Adresse der Variable.












                                       @100[ PBreadP ]                     @001[ šbersicht ]
.110
    PBrdDPR - Speicher aus dem reservierten DPR-Bereich lesen

    @111[PBrdDPR](enable,kr,offset,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  offset    : WORD          Offset im DPR (Dual Ported RAM) der Ziel-
                                  station.
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten abge-
                                  legt werden.
    ->  len       : WORD          L„nge der zu lesenden Daten in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).



                                     @111[ Fortsetzung ]                   @001[ šbersicht ]
.111
    PBrdDPR - Speicher aus dem reservierten DPR-Bereich lesen (Fortsetzung)

    Mit der Funktion PBrdDPR() k”nnen Daten aus dem Dual Ported RAM des
    Netzwerk-Controllers gelesen werden. D.h. diese Funktion erm”glicht einen
    direkten Zugriff auf den, fr den Anwender zug„nglichen, Speicherbereich
    im DPR des Netzwerk-Controllers. Dieser Speicherbereich muá auf der Ziel-
    station durch Aufruf der Funktion @021[PBinit] reserviert werden (anschlieáend
    kann ber den Ausgangsparameter "memadr" der Funktion PBinit() auf diesen
    Speicherbereich zugegriffen werden).
    Die gelesenen Daten werden in den angegebenen Datenpuffer ("data") ge-
    schrieben. Der Parameter "len" gibt die L„nge der zu lesenden Daten an.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.






                                     @112[ Fortsetzung ]                   @001[ šbersicht ]
.112
    PBrdDPR - Speicher aus dem reservierten DPR-Bereich lesen (Fortsetzung)

    Anmerkungen:
    - Es wird keine Konsistenz der Daten garantiert. D.h. der Anwender muá
      selbst sicherstellen, daá w„hrend der Leseoperation nicht gleichzeitig
      auch die Applikation auf der Zielstation auf diese Daten im DPR zugreift
      (die Daten werden vom Netzwerk-Controller byteweise aufsteigend aus dem
      DPR kopiert, keine WORD, LONG Konsistenz!).
    - Die Funktion PBrdDPR() ist kein Standard-PROFIBUS-Dienst, d.h. diese
      Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten ver-
      wendet werden!
    - Das DPR des Netzwerk-Controllers ist nicht nullspannungssicher.









                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.120
    PBrdDVL - Variablen ber dynamische Variablenliste lesen

    @121[PBrdDVL](enable,kr,adr(liste),anzahl,ind_phy,adr(data),len,ready,
            error_nr,rdlen)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der gelesen werden
                                  soll.
    ->  @125[liste     ]: WORD (FELD)   Dynamische Variablenliste in Form einer Feld-
                    oder          variable. Die Variablen werden in der
                    LONG (FELD)   Variablenliste ber die PROFIBUS-Indizes
                                  (Variablenliste = WORD-Feld) bzw. ber die
                                  physikalischen Adressen (Variablenliste =
                                  LONG-Feld) definiert.



                                     @121[ Fortsetzung ]                   @001[ šbersicht ]
.121
    PBrdDVL - Variablen ber dynamische Variablenliste lesen (Fortsetzung)

                                  Die PROFIBUS-Indizes bzw. die physikalischen
                                  Adressen der Variablen auf der Zielstation
                                  k”nnen mit der Funktion @250[PBgetOVN] ermittelt
                                  werden.
    ->  anzahl    : BYTE          Anzahl der Variablen in der Variablenliste
                                  (liste).
    ->  ind_phy   : BYTE          Zugriff ber PROFIBUS-Index oder physikalische
                                  Adresse:
                                  0 ... Liste mit PROFIBUS-Indizes
                                        (Variablenliste = WORD-Feld).
                                  1 ... Liste mit physikalischen Adressen
                                        (Variablenliste = LONG-Feld).
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten ab-
                                  gelegt werden.
    ->  len       : WORD          L„nge der Daten, die gelesen werden sollen
                                  (in Byte).



                                     @122[ Fortsetzung ]                   @001[ šbersicht ]
.122
    PBrdDVL - Variablen ber dynamische Variablenliste lesen (Fortsetzung)

    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rdlen     : WORD          L„nge der gelesenen Daten (in Byte).

    Die Funktion PBrdDVL() erm”glicht das Lesen von mehreren Variablen, die in
    einer Liste (dynamische Variablenliste) bergeben werden. Beim Aufruf dieser
    Funktion wird eine Lese-Anforderung in Form einer Liste von PROFIBUS-Indizes
    bzw. physikalischen Adressen an die Zielstation gesendet. Die Zielstation
    antwortet mit den Werten der angeforderten Variablen. Die Werte werden in
    den angegebenen Datenpuffer ("data") geschrieben. Die Anzahl der Variablen
    in der Liste ist durch die maximale PROFIBUS-Frame-L„nge (ca. 230 Byte)
    begrenzt. D.h. die L„nge der einzelnen Variablen muá dem Anwender implizit
    bekannt sein.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.


                                     @123[ Fortsetzung ]                   @001[ šbersicht ]
.123
    PBrdDVL - Variablen ber dynamische Variablenliste lesen (Fortsetzung)

    Anmerkung:
    Die Funktion PBrdDVL() ist kein Standard-PROFIBUS-Dienst, d.h. diese
    Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten ver-
    wendet werden!















                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.125
    PBrdDVL - Variablen ber dynamische Variablenliste lesen (Fortsetzung)

    -> Parameter <liste     >: WORD (FELD) oder LONG (FELD)

    Dynamische Variablenliste in Form einer Feldvariable.
    Die Variablen werden in der dynamischen Variablenliste ber die PROFIBUS-
    Indizes (Variablenliste = WORD-Feld) bzw. ber die physikalischen Adressen
    (Variablenliste = LONG-Feld) definiert.
    Die PROFIBUS-Indizes bzw. die physikalischen Adressen der Variablen auf
    der Zielstation k”nnen mit der Funktion @250[PBgetOVN] ermittelt werden. Diese
    Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Zielstation.
    Das Element "Index" (Datentyp WORD) dieser Objektbeschreibung enth„lt den
    PROFIBUS-Index der Variable, das Element "Local-Address" (Datentyp LONG)
    die physikalische Adresse der Variable.







                                       @120[ PBrdDVL ]                     @001[ šbersicht ]
.130
    PBwriteI - Variable/Variablenliste ber Index beschreiben

    @131[PBwriteI](enable,kr,index,subindex,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @135[index     ]: WORD          PROFIBUS-Index der Variable bzw. der
                                  Variablenliste, die auf der Zielstation be-
                                  schrieben werden soll. Der PROFIBUS-Index kann
                                  mit der Funktion @250[PBgetOVN] ermittelt werden.
    ->  @136[subindex  ]: WORD          Subindex der Variable, die auf der Zielstation
                                  beschrieben werden soll. Beim Beschreiben von
                                  Variablenlisten muá fr den Subindex immer der
                                  Wert 0 angegeben werden.
    ->  data      : ALLE          Datenpuffer, in dem die zu schreibenden Daten
                                  angegeben sind.


                                     @131[ Fortsetzung ]                   @001[ šbersicht ]
.131
    PBwriteI - Variable/Variablenliste ber Index beschreiben (Fortsetzung)

    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit der Funktion PBwriteI() kann eine Variable/Variablenliste auf einer
    anderen PROFIBUS-Station beschrieben werden. Die Referenzierung der
    Variable/Variablenliste erfolgt ber den (in der Objektbeschreibung an-
    gegebenen) PROFIBUS-Index dieser Variable/Variablenliste.
    Die zu schreibenden Daten mssen im Datenpuffer "data" abgelegt werden.
    Der Parameter "len" gibt die L„nge der zu schreibenden Daten an. Der
    Anwender ist selbst dafr verantwortlich, daá die angegebene L„nge mit
    der L„nge des Objekts auf der Zielstation bereinstimmt! Wenn die ange-
    gebene L„nge gr”áer oder kleiner als die tats„chliche L„nge des Objekts
    auf der Zielstation ist, wird ein Fehler von der Zielstation gemeldet.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

                                     @132[ Fortsetzung ]                   @001[ šbersicht ]
.132
    PBwriteI - Variable/Variablenliste ber Index beschreiben (Fortsetzung)

    Mit dieser Funktion kann nur auf Variablen/Variablenlisten zugegriffen
    werden, deren L„nge die maximal m”gliche L„nge eines PROFIBUS-Frames
    (ca. 230 Byte) nicht bersteigt! Fr Variablen mit einer L„nge gr”áer
    230 Bytes muá die Funktion PBwriteX() verwendet werden.

    Anmerkung:
    Variablenlisten k”nnen mit den Funktionen @190[PBdefVLI] und @200[PBdefVLN] definiert
    werden!











                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.135
    PBwriteI - Variable/Variablenliste ber Index beschreiben (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index der zu beschreibenden Variable/Variablenliste auf der Ziel-
    station. Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden.
    Diese Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Ziel-
    station. Das erste Element (Element "Index", Datentyp WORD) dieser Objekt-
    beschreibung enth„lt den Index der Variable/Variablenliste.












                                      @130[ PBwriteI ]                     @001[ šbersicht ]
.136
    PBwriteI - Variable/Variablenliste ber Index beschreiben (Fortsetzung)

    -> Parameter <subindex  >: WORD

    @542[Subindex] der zu beschreibenden Variable. Beim Beschreiben von Variablen-
    listen muá fr den Subindex immer der Wert 0 angegeben werden.















                                      @130[ PBwriteI ]                     @001[ šbersicht ]
.140
    PBwriteN - Variable/Variablenliste ber Name beschreiben

    @141[PBwriteN](enable,kr,spec_id,adr(name),subindex,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  spec_id   : BYTE          Der Parameter spec_id legt fest, ob fr den
                                  Parameter name der Name einer Variable oder
                                  der Name einer Variablenliste angegeben wird:
                                  1 ... Name einer Prozeávariable.
                                  2 ... Name einer Variablenliste.
    ->  name      : BYTE (FELD)   Name der Prozeávariable (PV-Name) bzw. Name
                                  der Variablenliste auf der Zielstation
                                  (als String).




                                     @141[ Fortsetzung ]                   @001[ šbersicht ]
.141
    PBwriteN - Variable/Variablenliste ber Name beschreiben (Fortsetzung)

                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
    ->  @145[subindex  ]: WORD          Subindex der Variable, die auf der Zielstation
                                  beschrieben werden soll. Beim Beschreiben von
                                  Variablenlisten muá fr den Subindex immer der
                                  Wert 0 angegeben werden.
    ->  data      : ALLE          Datenpuffer, in dem die zu schreibenden Daten
                                  angegeben sind.
    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).




                                     @142[ Fortsetzung ]                   @001[ šbersicht ]
.142
    PBwriteN - Variable/Variablenliste ber Name beschreiben (Fortsetzung)

    Mit der Funktion PBwriteN() kann eine Variable/Variablenliste auf einer
    anderen PROFIBUS-Station beschrieben werden. Die Referenzierung der
    Variable/Variablenliste erfolgt ber den PV-Namen/Variablenlisten-Namen.
    Die zu schreibenden Daten mssen im Datenpuffer "data" abgelegt werden.
    Der Parameter "len" gibt die L„nge der zu schreibenden Daten an. Der
    Anwender ist selbst dafr verantwortlich, daá die angegebene L„nge mit der
    L„nge des Objekts auf der Zielstation bereinstimmt! Ist die angegebene
    L„nge gr”áer oder kleiner als die tats„chliche L„nge des Objekts, wird ein
    Fehler von der Zielstation gemeldet.
    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Mit dieser Funktion kann nur auf Variablen/Variablenlisten zugegriffen
    werden, deren L„nge die maximal m”gliche L„nge eines PROFIBUS-Frames
    (ca. 230 Byte) nicht bersteigt! Fr Variablen mit einer L„nge gr”áer
    230 Bytes muá die Funktion @150[PBwriteX] verwendet werden.


                                     @143[ Fortsetzung ]                   @001[ šbersicht ]
.143
    PBwriteN - Variable/Variablenliste ber Name beschreiben (Fortsetzung)

    Anmerkung:
    Variablenlisten k”nnen mit den Funktionen @190[PBdefVLI] und @200[PBdefVLN] definiert
    werden!

    Der Zugriff auf Variablen ber ihren PV-Namen ist einfach, aber wesentlich
    langsamer als der Zugriff ber den PROFIBUS-Index mit der Funktion
    @130[PBwriteI].












                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.145
    PBwriteN - Variable/Variablenliste ber Name beschreiben (Fortsetzung)

    -> Parameter <subindex  >: WORD

    @542[Subindex] der zu beschreibenden Variable. Beim Beschreiben von Variablen-
    listen muá fr den Subindex immer der Wert 0 angegeben werden.















                                      @140[ PBwriteN ]                     @001[ šbersicht ]
.150
    PBwriteX - Variable extended (l„nger als Frame) beschreiben

    @151[PBwriteX](enable,kr,offset,adr(name),adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @155[offset    ]: WORD          Offset (bezogen auf die Adresse der Variable),
                                  ab dem geschrieben wird.
    ->  name      : BYTE (FELD)   Name der Prozeávariable (PV-Name) bzw. Name
                                  der Variablenliste auf der Zielstation
                                  (als String).
                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).

                                     @151[ Fortsetzung ]                   @001[ šbersicht ]
.151
    PBwriteX - Variable extended (l„nger als Frame) beschreiben (Fortsetzung)

    ->  data      : ALLE          Datenpuffer, in dem die zu schreibenden Daten
                                  angegeben sind.
    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Die Funktion PBwriteX() erm”glicht das Beschreiben von Variablen, deren
    L„nge die maximal m”gliche L„nge eines PROFIBUS-Frames (ca. 230 Byte) ber-
    schreitet. Um die gesamte Variable zu beschreiben, sind daher mehrere
    Zugriffe notwendig. Fr den Anwender ist diese Problematik aber ohne
    Bedeutung, da die Zugriffe von der Funktion selbst„ndig durchgefhrt werden
    und nach erfolgreichem Abschluá der Dienst wie ein einzelnes Write best„tigt
    wird.
    Die zu schreibenden Daten mssen im Datenpuffer "data" abgelegt werden. Der
    Parameter "len" gibt die L„nge der zu schreibenden Daten an.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.
                                     @152[ Fortsetzung ]                   @001[ šbersicht ]
.152
    PBwriteX - Variable extended (l„nger als Frame) beschreiben (Fortsetzung)

    Interner Ablauf der Funktion:
    - Als erstes wird mit einem Get-OV-Dienst ber den PV-Namen die Objekt-
      beschreibung der gewnschten Variable angefordert. Daraus l„át sich die
      physikalische Adresse der Variable bestimmen. 
    - Anschlieáend werden, beginnend ab dieser physikalischen Adresse (plus
      dem angegebenen Offset "offset"), solange physikalische Write-Dienste
      abgesetzt, bis die angegebene L„nge an Daten geschrieben wurde.
    - Der Get-OV-Dienst wird nur bei der erstmaligen Dienstanforderung ausge-
      fhrt. ndert sich der PV-Name und die logische Verbindungsnummer bei
      weiteren Aufrufen nicht mehr, werden direkt die physikalischen Write-
      Dienste abgewickelt.

    Anmerkung:
    Die Funktion PBwriteX() ist kein Standard-PROFIBUS-Dienst, d.h. diese
    Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten verwendet
    werden!



                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.155
    PBwriteX - Variable extended (l„nger als Frame) beschreiben (Fortsetzung)

    -> Parameter <offset    >: WORD

    Der Parameter "offset" ist beim Zugriff auf Elemente von Feldern (Arrays)
    oder Strukturen von Bedeutung. Dieser Parameter gibt an, ab welchem Offset
    (in Byte) die Elemente einer Struktur- oder Feldvariable beschrieben werden.
    Um das gesamte Feld bzw. die ganze Struktur zu beschreiben, muá fr den
    Parameter "offset" der Wert 0 angegeben werden!
    Soll zum Beispiel eine Feldvariable (Datentyp LONG, L„nge 60) ab dem dritten
    Element (Element mit Index 2) beschrieben werden, so muá fr den Parameter
    "offset" der Wert 8 (2 LONG = 8 Byte) angegeben werden!









                                      @150[ PBwriteX ]                     @001[ šbersicht ]
.160
    PBwriteP - Variable ber physikalische Adresse beschreiben

    @161[PBwriteP](enable,kr,phy_adr,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @165[phy_adr   ]: LONG          Physikalische Adresse der Variable auf der
                                  Zielstation. Die physikalische Adresse kann
                                  mit der Funktion @250[PBgetOVN] ermittelt werden.
    ->  data      : ALLE          Datenpuffer, in dem die zu schreibenden Daten
                                  angegeben sind.
    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
                                  šberschreitet die L„nge der zu schreibenden
                                  Daten die maximal m”gliche Gr”áe eines
                                  PROFIBUS-Frames (ca. 230 Byte), so werden die
                                  Daten automatisch auf mehrere Transfers aufge-
                                  teilt.

                                     @161[ Fortsetzung ]                   @001[ šbersicht ]
.161
    PBwriteP - Variable ber physikalische Adresse beschreiben (Fortsetzung)

    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit dieser Funktion kann eine Variable auf einer anderen PROFIBUS-Station
    beschrieben werden. Die Referenzierung der Variable erfolgt ber die in der
    Objektbeschreibung angegebene physikalische Adresse dieser Variable.
    Die zu schreibenden Daten mssen im Datenpuffer "data" abgelegt werden. Der
    Parameter "len" gibt die L„nge der zu schreibenden Daten an. Auf der Ziel-
    station findet keine Prfung der L„nge statt.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.






                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.165
    PBwriteP - Variable ber physikalische Adresse beschreiben (Fortsetzung)

    -> Parameter <phy_adr   >: LONG

    Physikalische Adresse der zu beschreibenden Variable auf der Zielstation.
    Die physikalische Adresse kann ber die Funktion @250[PBgetOVN] ermittelt werden.
    Diese Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Ziel-
    station. Das Element "Local-Address" (Datentyp LONG) dieser Objekt-
    beschreibung enth„lt die physikalische Adresse der Variable.












                                      @160[ PBwriteP ]                     @001[ šbersicht ]
.170
    PBwrDPR - Speicher im reservierten DPR-Bereich beschreiben

    @171[PBwrDPR](enable,kr,offset,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  offset    : WORD          Offset im DPR (Dual Ported RAM) der Ziel-
                                  station.
    ->  data      : ALLE          Datenpuffer, in den die zu schreibenden Daten
                                  angegeben sind.
    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).





                                     @171[ Fortsetzung ]                   @001[ šbersicht ]
.171
    PBwrDPR - Speicher im reservierten DPR-Bereich beschreiben (Fortsetzung)

    Mit der Funktion PBwrDPR() k”nnen Daten in das Dual Ported RAM des Netzwerk-
    Controllers geschrieben werden. D.h. diese Funktion erm”glicht einen
    direkten Zugriff auf den fr den Anwender zug„nglichen Speicherbereich im
    DPR des Netzwerk-Controllers. Dieser Speicherbereich muá auf der Zielstation
    durch Aufruf der Funktion @021[PBinit] reserviert werden (anschlieáend kann ber
    den Ausgangsparameter "memadr" der Funktion PBinit() auf diesen Speicher-
    bereich zugegriffen werden).
    Die zu schreibenden Daten mssen im Datenpuffer "data" abgelegt werden. Der
    Parameter "len" gibt die L„nge der zu schreibenden Daten an. Auf der Ziel-
    station findet keine Prfung der L„nge statt.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.





                                     @172[ Fortsetzung ]                   @001[ šbersicht ]
.172
    PBwrDPR - Speicher im reservierten DPR-Bereich beschreiben (Fortsetzung)

    Anmerkungen:
    - Es wird keine Konsistenz der Daten garantiert. D.h. der Anwender muá
      selbst sicherstellen, daá w„hrend der Schreiboperation nicht gleichzeitig
      auch die Applikation auf der Zielstation auf diese Daten im DPR zugreift
      (die Daten werden vom Netzwerk-Controller byteweise aufsteigend in das DPR
      kopiert, keine WORD, LONG Konsistenz!).
    - Die Funktion PBwrDPR() ist kein Standard-PROFIBUS-Dienst, d.h. diese
      Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten ver-
      wendet werden!
    - Das DPR des Netzwerk-Controllers ist nicht nullspannungssicher.









                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.180
    PBwrDVL - Variablen ber dyn. Variablenliste beschreiben

    @181[PBwrDVL](enable,kr,adr(liste),anzahl,ind_phy,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @185[liste     ]: WORD (FELD)   Dynamische Variablenliste in Form einer Feld-
                    oder          variable. Die Variablen werden in der
                    LONG (FELD)   Variablenliste ber die PROFIBUS-Indizes
                                  (Variablenliste = WORD-Feld) bzw. ber die
                                  physikalischen Adressen (Variablenliste =
                                  LONG-Feld) definiert.
                                  Die PROFIBUS-Indizes bzw. die physikalischen
                                  Adressen der Variablen auf der Zielstation
                                  k”nnen mit der Funktion @250[PBgetOVN] ermittelt
                                  werden.


                                     @181[ Fortsetzung ]                   @001[ šbersicht ]
.181
    PBwrDVL - Variablen ber dyn. Variablenliste beschreiben (Fortsetzung)

    ->  anzahl    : BYTE          Anzahl der Variablen in der Variablenliste
                                  (liste).
    ->  ind_phy   : BYTE          Zugriff ber PROFIBUS-Index oder physikalische
                                  Adresse:
                                  0 ... Liste mit PROFIBUS-Indizes
                                        (Variablenliste = WORD-Feld).
                                  1 ... Liste mit physikalischen Adressen
                                        (Variablenliste = LONG-Feld).
    ->  data      : ALLE          Datenpuffer, in dem die zu schreibenden Daten
                                  angegeben sind.
    ->  len       : WORD          L„nge der zu schreibenden Daten (in Byte).
    <-  ready     : BIT           Dienst ist fertig:
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).






                                     @182[ Fortsetzung ]                   @001[ šbersicht ]
.182
    PBwrDVL - Variablen ber dyn. Variablenliste beschreiben (Fortsetzung)

    Die Funktion PBwrDVL() erm”glicht das Beschreiben von mehreren Variablen,
    die in einer Liste (dynamische Variablenliste) bergeben werden. Beim
    Aufruf dieser Funktion wird eine Schreib-Anforderung in Form einer Liste
    von PROFIBUS-Indizes bzw. physikalischen Adressen mit den angegebenen Daten
    (Parameter "data") an die Zielstation gesendet. Wenn der Dienst fehlerfrei
    ausgefhrt wurde, antwortet die Zielstation mit einer Best„tigung. Falls ein
    Fehler aufgetreten ist, wird am Ausgang "error_nr" eine entsprechende
    Fehlernummer ausgegeben.
    Der Aufruf dieses Dienstes ist also erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Anmerkung:
    Die Funktion PBwrDVL() ist kein Standard-PROFIBUS-Dienst, d.h. diese
    Funktion kann nur fr den Datenaustausch zwischen zwei B&R-Ger„ten ver-
    wendet werden!



                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.185
    PBwrDVL - Variablen ber dyn. Variablenliste beschreiben (Fortsetzung)

    -> Parameter <liste     >: WORD (FELD) oder LONG (FELD)

    Dynamische Variablenliste in Form einer Feldvariable.
    Die Variablen werden in der dynamischen Variablenliste ber die PROFIBUS-
    Indizes (Variablenliste = WORD-Feld) bzw. ber die physikalischen Adressen
    (Variablenliste = LONG-Feld) definiert.
    Die PROFIBUS-Indizes bzw. die physikalischen Adressen der Variablen auf der
    Zielstation k”nnen mit der Funktion @250[PBgetOVN] ermittelt werden. Diese
    Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Zielstation.
    Das Element "Index" (Datentyp WORD) der Objektbeschreibung enth„lt den
    PROFIBUS-Index der Variable, das Element "Local-Address" (Datentyp LONG)
    die physikalische Adresse der Variable.







                                       @180[ PBwrDVL ]                     @001[ šbersicht ]
.190
    PBdefVLI - Variablenliste ber Index definieren

    @191[PBdefVLI](enable,kr,adr(liste),anzahl,pw,group,rights,adr(name),ready,
             error_nr,newindex)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  liste     : WORD (FELD)   Variablenliste in Form einer Feldvariable.
                                  Die Variablen werden in der Variablenliste
                                  ber die PROFIBUS-Indizes (Variablenliste =
                                  WORD-Feld) definiert. Die PROFIBUS-Indizes
                                  der Variablen auf der Zielstation k”nnen mit
                                  der Funktion @250[PBgetOVN] ermittelt werden.
    ->  anzahl    : BYTE          Anzahl der Variablen in der Variablenliste
                                  (liste).



                                     @191[ Fortsetzung ]                   @001[ šbersicht ]
.191
    PBdefVLI - Variablenliste ber Index definieren (Fortsetzung)

    ->  pw        : BYTE          PROFIBUS-Paáwort ("Password"), das die neue
                                  Variablenliste haben soll. Standardwert ist 0.
    ->  group     : BYTE          PROFIBUS-Gruppe ("Access-Groups"), der die
                                  neue Variablenliste angeh”ren soll. Standard-
                                  wert ist $FF.
    ->  rights    : WORD          PROFIBUS-Zugriffsrechte ("Access-Rights"), die
                                  die neue Variablenliste haben soll. Standard-
                                  wert ist $33.
    ->  name      : BYTE (FELD)   Name der neuen Variablenliste (als String).
                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
                                  Wenn fr adr(name) der Wert 0 angegeben wird,
                                  erh„lt die Variablenliste keinen Namen.


                                     @192[ Fortsetzung ]                   @001[ šbersicht ]
.192
    PBdefVLI - Variablenliste ber Index definieren (Fortsetzung)

    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  newindex  : WORD          PROFIBUS-Index der neuen Variablenliste.

    Diese Funktion erzeugt aus den (ber die PROFIBUS-Indizes) angegebenen
    Variablen eine neue Variablenliste.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Anschlieáend kann mit einem einzigen Lese- bzw. Schreibbefehl auf alle
    Variablen dieser Variablenliste zugegriffen werden. Bei den Funktionen
    @071[PBreadI] und @130[PBwriteI] erfolgt die Referenzierung der Variablenliste ber
    den PROFIBUS-Index (Parameter "newindex"). Bei den Funktionen @080[PBreadN] und
    @140[PBwriteN] wird die Variablenliste ber den Variablenlisten-Namen
    (Parameter "name") referenziert.


                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.200
    PBdefVLN - Variablenliste ber Name definieren

    @201[PBdefVLN](enable,kr,adr(liste),anzahl,pw,group,rights,adr(name),ready,
             error_nr,newindex)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  liste     : LONG (FELD)   Variablenliste in Form einer Feldvariable.
                                  Die Variablen werden in der Liste mit Hilfe
                                  von Zeigern auf Prozeávariablen-Namen
                                  (PV-Namen) definiert. D.h. die Variablenliste
                                  ist als Feld von Zeigern auf PV-Namen anzu-
                                  legen. Alle PV-Namen mssen mit 0 abge-
                                  schlossen werden.
    ->  anzahl    : BYTE          Anzahl der Variablen in der Variablenliste
                                  (liste).


                                     @201[ Fortsetzung ]                   @001[ šbersicht ]
.201
    PBdefVLN - Variablenliste ber Name definieren (Fortsetzung)

    ->  pw        : BYTE          PROFIBUS-Paáwort ("Password"), das die neue
                                  Variablenliste haben soll. Standardwert ist 0.
    ->  group     : BYTE          PROFIBUS-Gruppe ("Access-Groups"), der die
                                  neue Variablenliste angeh”ren soll. Standard-
                                  wert ist $FF.
    ->  rights    : WORD          PROFIBUS-Zugriffsrechte ("Access-Rights"), die
                                  die neue Variablenliste haben soll. Standard-
                                  wert ist $33.
    ->  name      : BYTE (FELD)   Name der neuen Variablenliste (als String).
                                  Der String kann auf zwei verschiedene Arten
                                  angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
                                  Wenn fr adr(name) der Wert 0 angegeben wird,
                                  erh„lt die Variablenliste keinen Namen.


                                     @202[ Fortsetzung ]                   @001[ šbersicht ]
.202
    PBdefVLN - Variablenliste ber Name definieren (Fortsetzung)

    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  newindex  : WORD          PROFIBUS-Index der neuen Variablenliste.

    Diese Funktion erzeugt aus den (ber die PV-Namen) angegebenen Variablen
    eine neue Variablenliste.
    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Anschlieáend kann mit einem einzigen Lese- bzw. Schreibbefehl auf alle
    Variablen dieser Variablenliste zugegriffen werden. Bei den Funktionen
    @071[PBreadI] und @130[PBwriteI] erfolgt die Referenzierung der Variablenliste ber
    den PROFIBUS-Index (Parameter "newindex"). Bei den Funktionen @080[PBreadN] und
    @140[PBwriteN] wird die Variablenliste ber den Variablenlisten-Namen (Parameter
    "name") referenziert.



                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.210
    PBdelVLI - Variablenliste ber Index l”schen

    @211[PBdelVLI](enable,kr,index,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @215[index     ]: WORD          PROFIBUS-Index der Variablenliste, die ge-
                                  l”scht werden soll. Der PROFIBUS-Index der
                                  Variablenliste kann mit der Funktion @250[PBgetOVN]
                                  ermittelt werden.    
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Durch die Funktion PBdelVLI() wird die (ber den PROFIBUS-Index) angegebene
    Variablenliste auf der Zielstation gel”scht.



                                     @211[ Fortsetzung ]                   @001[ šbersicht ]
.211
    PBdelVLI - Variablenliste ber Index l”schen (Fortsetzung)

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.
















                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.215
    PBdelVLI - Variablenliste ber Index l”schen (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index der zu l”schenden Variablenliste auf der Zielstation.
    Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden. Diese
    Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Zielstation.
    Das erste Element (Element "Index", Datentyp WORD) dieser Objektbeschreibung
    enth„lt den Index der Variablenliste.












                                      @210[ PBdelVLI ]                     @001[ šbersicht ]
.220
    PBdelVLN - Variablenliste ber Name l”schen

    @221[PBdelVLN](enable,kr,adr(name),ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  name      : BYTE (FELD)   Name der Variablenliste, die gel”scht werden
                                  soll (als String). Der String kann auf zwei
                                  verschiedene Arten angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).



                                     @221[ Fortsetzung ]                   @001[ šbersicht ]
.221
    PBdelVLN - Variablenliste ber Name l”schen (Fortsetzung)

    Durch diese Funktion wird die (ber den Variablenlisten-Namen) angegebene
    Variablenliste auf der Zielstation gel”scht.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.













                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.230
    PROFIBUS-Library - Variablendienste (Beispiel)

    Beispiel zu den Variablendiensten:
    Wir verwenden die Steuerungen RPS0 (Stationsadresse 0) und RPS1
    (Stationsadresse 1). Die beiden ben”tigten Verbindungen (RPS0 und RPS1) sind
    im Netzwerkkonfigurationsmodul NW_S1STD.BR definiert. Dieses Netzwerk-
    konfigurationsmodul muá daher im Anwender-ROM beider Steuerungen (RPS0 und
    RPS1) vorhanden sein.

    Ablauf:
    RPS1 baut zu RPS0 eine Verbindung auf. Sowohl RPS0 als auch RPS1 beschreiben
    und lesen jeweils eine Variable der Zielstation.
    Der aktuelle Zustand wird am Status-Display der Zentraleinheit (nur System
    B&R 2010) angezeigt.







                               @231[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.231
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

    INIT-UP der Task:
    - Im INIT-UP der Task muá die Funktion PBinit() aufgerufen werden (PROFIBUS-
      Initialisierung).
    - Anschlieáend wird im INIT-UP die Verbindungsnummer (kr) zum symbolischen
      Namen der Verbindung bestimmt. Dabei wird die eigene Stationsadresse er-
      mittelt und abh„ngig davon die Verbindung RPS0 oder RPS1 verwendet.

      ; PROFIBUS-Initialisierung
      okay = 0
      rw_var = 0            ; fr Schreib/Leseoperation von der Gegenstation
      PBinit(1,10,1000,0,inierr,memadr)
      if inierr = 0 then
          ; PROFIBUS-Funktionen sind richtig initialisiert!
          ; Bestimme die eigene Stationsadresse, und gleichzeitig die kr
          ; von "SPS0"
          PBinfoKR(1,"SPS0",adr(kr_info),err,kr)



                               @232[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.232
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

          if err = 0 then
              src_adr = kr_info.src_adr
              if src_adr = 0 then
                  ; eigene Stationsadresse ist 0
                  ; Verbindung "SPS1" verwenden, kr bestimmen
                  PBinfoKR(1,"SPS1",0,err,kr)
                  if err = 0 then
                      okay = 1    ; alles o.k.
                  endif
              else if src_adr = 1 then
                  ; eigene Stationsadresse ist 1
                  ; Verbindung zur Station 0 aufbauen
                  ; kr wurde bereits oben bestimmt "SPS0"
                  en_con = 1
                  okay = 1
              endif
          endif
      endif

                               @233[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.233
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

    Zyklischer Teil der Task:
    - Bevor der eigentliche Datenaustausch beginnen kann, muá der Verbindungs-
      aufbau eingeleitet werden. Dabei baut die SPS1 zur SPS0 die Verbindung auf
      (siehe INIT-UP, en_con=1).
    - Nach dem Anstoáen des Verbindungsaufbaus (rdycon=1) wird das restliche
      Programm gestartet.
    - Dazu wird mit der Funktion PBstatKR() geprft, ob die Verbindung bereits
      aufgebaut ist. Ist die Verbindung bereits aufgebaut, wird sofort der
      Write-Dienst abgesetzt.
    - Nach einem erfolgreichen Write wird dieselbe Variable mit dem Read-Dienst
      zurckgelesen und mit dem geschriebenen Wert verglichen. Stimmen die Werte
      nicht berein, bleibt die Applikation mit einer Fehlermeldung (am Status-
      Display der CPU) stehen.
    - Tritt w„hrend eines Datentransfers ein Fehler auf, oder wird die Ver-
      bindung unterbrochen (Ziehen des Bussteckers), meldet dies der Read- bzw.
      Write-Funktionsblock. Ein erneuter Start des Vorgangs wird ber die
      Abfrage des Verbindungsstatus mit der Funktion PBstatKR() eingeleitet.


                               @234[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.234
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

    - Die Anzahl der Read/Write-Zyklen sowie aufgetretene Fehler werden am
      Status-Display der CPU ausgegeben.

      if (okay = 1) and (en_con = 1) then
          ; Verbindung zu Station 0 aufbauen
          ; PBautoKR() muá zyklisch aufgerufen werden, bis rdycon=1
          PBautoKR(en_con,kr,1,rdycon,err)
          if rdycon = 1 then
              en_con = 0
          else if err <> 0 then
              en_con = 0
              okay = 0
          endif
      endif
      if okay = 1 then
          if (en_wrn = 0) AND (en_rdn = 0) then
              ; Prfe Status der Verbindung
              ; Wenn o.k., starte en_wrn

                               @235[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.235
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

              PBstatKR(1,kr,err,krstat)
              if krstat = $FF then
                  en_wrn = 1
                  ; Verbindung zur Gegenstation ist aufgebaut
                  DIS_str(0,0,"CONN. OK")
              else
                  DIS_str(0,0,"NO-CONN!")
              endif
          endif
          ; Dienste absetzen. Abwechselnd wird ein Write per Name und
          ; ein Read per Name auf die Gegenstation abgesetzt
          PBwriteN(en_wrn,kr,1,"rw_var",0,adr(wr_var),2,rdy_wrn,err_wrn)
          if rdy_wrn = 1 then
              en_wrn = 0
              en_rdn = 1
          else if err_wrn <> 0 then
              en_wrn = 0
              wrerr_ctr = wrerr_ctr + 1

                               @236[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.236
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

              if wrerr_ctr > 9999 then
                  wrerr_ctr = 0
              endif
              DIS_str(1,0,"WE:    ")
              itoa(err_wrn,adr(disp_str))
              DIS_str(1,4,adr(disp_str))
          endif
          PBreadN(en_rdn,kr,1,"rw_var",0,adr(rd_var),2,rdy_rdn,err_rdn)
          if rdy_rdn = 1 then
              en_rdn = 0
              if rd_var <> wr_var then
                  DIS_str(0,0,"ERROR    ")
              else
                  itoa(wr_var,adr(disp_str))
                  DIS_str(1,0,"V:    ")
                  DIS_str(1,2,adr(disp_str))
                  wr_var = wr_var + 1
                  en_wrn = 1
              endif
                               @237[ Fortsetzung - Beispiel ]              @001[ šbersicht ]
.237
    PROFIBUS-Library - Variablendienste (Beispiel - Fortsetzung)

              en_rdn = 0
              rderr_ctr = rderr_ctr + 1
              if rderr_ctr > 9999 then
                  rderr_ctr = 0
              endif
              DIS_str(1,0,"RE:    ")
              itoa(err_rdn,adr(disp_str))
              DIS_str(1,4,adr(disp_str))
          endif
      else
          itoa(err,adr(disp_str))
          DIS_str(0,0,"IE: ")
          DIS_str(1,4,adr(disp_str))
      endif





                                  @070[ Variablendienste ]                 @001[ šbersicht ]
.240
    PROFIBUS-Library - OV-Management

    Mit den Funktionen der Gruppe OV-Management k”nnen Objektbeschreibungen von
    Objekten einer anderen PROFIBUS-Station angefordert werden:

    @241[PBgetOVI] Objektbeschreibung ber Index holen
    @250[PBgetOVN] Objektbeschreibung ber Name holen
    @260[PBgetOVM] Objektbeschreibungen mehrerer Objekte holen













                                                                     @001[ šbersicht ]
.241
    PBgetOVI - Objektbeschreibung ber Index holen

    @242[PBgetOVI](enable,kr,index,long_ver,adr(data),len,ready,error_nr,obj_len)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der eine Objekt-
                                  beschreibung gelesen werden soll.
    ->  @245[index     ]: WORD          PROFIBUS-Index der Objektbeschreibung, die
                                  von der Zielstation gelesen werden soll.
    ->  @246[long_ver  ]: BYTE          Es kann zwischen zwei Formaten fr die Objekt-
                                  beschreibung gew„hlt werden:
                                  0 ... Short-Version
                                  1 ... Long-Version
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten
                                  (Objektbeschreibung) abgelegt werden.
    ->  len       : WORD          Gr”áe des Datenpuffers (data) in Byte.

                                     @242[ Fortsetzung ]                   @001[ šbersicht ]
.242
    PBgetOVI - Objektbeschreibung ber Index holen (Fortsetzung)

    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  obj_len   : BYTE          L„nge der gelesenen Daten (Objektbeschreibung)
                                  in Byte.

    Mit der Funktion PBgetOVI() kann die Objektbeschreibung eines Objekts auf
    der Zielstation angefordert werden. Die Referenzierung des Objekts erfolgt
    ber den (in der Objektbeschreibung angegebenen) PROFIBUS-Index dieses
    Objekts.
    Die gelesenen Daten der Objektbeschreibung werden in den angegebenen Daten-
    puffer ("data") geschrieben. Der Aufbau und die einzelnen Komponenten
    (Elemente) einer Objektbeschreibung sind im Anhang @650[Objektbeschreibung]
    erkl„rt.






                                     @243[ Fortsetzung ]                   @001[ šbersicht ]
.243
    PBgetOVI - Objektbeschreibung ber Index holen (Fortsetzung)

    Achtung!
    Auf eine Objektbeschreibung kann nicht ber eine Struktur zugegriffen
    werden, da die einzelnen Elemente nicht auf WORD ausgerichtet sind (WORD-
    oder LONG-Elemente k”nnen bei einer ungeraden Adresse beginnen). Der Zugriff
    auf eine Objektbeschreibung ist z.B. ber ein BYTE-Feld m”glich.

    Der Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.










                                    @240[ OV-Management ]                  @001[ šbersicht ]
.245
    PBgetOVI - Objektbeschreibung ber Index holen (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index der Objektbeschreibung, die von der Zielstation gelesen
    werden soll. Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden.















                                      @241[ PBgetOVI ]                     @001[ šbersicht ]
.246
    PBgetOVI - Objektbeschreibung ber Index holen (Fortsetzung)

    -> Parameter <long_ver  >: BYTE

    Es kann zwischen zwei Formaten fr die Objektbeschreibung gew„hlt werden:

    Long-Version .... Es werden alle Informationen, die von einem Objekt zur
                      Verfgung stehen, bertragen.
    Short-Version ... Es werden nur die wichtigsten Objekt-Informationen ber-
                      tragen.

    Detaillierte Informationen zum Thema "Long-/Short-Version" finden Sie im
    Anhang @650[Objektbeschreibung].








                                      @241[ PBgetOVI ]                     @001[ šbersicht ]
.250
    PBgetOVN - Objektbeschreibung ber Name holen

    @251[PBgetOVN](enable,kr,spec_id,adr(name),long_ver,adr(data),len,ready,
             error_nr,obj_len)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der eine Objekt-
                                  beschreibung gelesen werden soll.
    ->  @255[spec_id   ]: BYTE          Der Parameter spec_id legt fest, welcher
                                  Objektgruppe das Objekt (dessen Beschreibung
                                  gelesen werden soll) angeh”rt. D.h. dieser
                                  Parameter gibt an, ob fr den Parameter name
                                  der Name einer Variable, Variablenliste, usw.
                                  angegeben wird:



                                     @251[ Fortsetzung ]                   @001[ šbersicht ]
.251
    PBgetOVN - Objektbeschreibung ber Name holen (Fortsetzung)

                                  1 ... Name einer Prozeávariable
                                  2 ... Name einer Variablenliste
                                  3 ... Domain-Name
                                  4 ... Program-Invocation-Name
                                  5 ... Event-Name    
    ->  name      : BYTE (FELD)   Name des Objekts auf der Zielstation
                                  (als String). Der String kann auf zwei ver-
                                  schiedene Arten angegeben werden:
                                  adr(name)    Adresse der BYTE-Feldvariable,
                                               die den String enth„lt.
                                  "name"       Konstanter String (muá in Anfh-
                                               rungszeichen angegeben werden!).
    ->  @256[long_ver  ]: BYTE          Es kann zwischen zwei Formaten fr die Objekt-
                                  beschreibung gew„hlt werden:
                                  0 ... Short-Version
                                  1 ... Long-Version
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten
                                  (Objektbeschreibung) abgelegt werden.

                                     @252[ Fortsetzung ]                   @001[ šbersicht ]
.252
    PBgetOVN - Objektbeschreibung ber Name holen (Fortsetzung)

    ->  len       : WORD          Gr”áe des Datenpuffers (data) in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  obj_len   : BYTE          L„nge der gelesenen Daten (Objektbeschreibung)
                                  in Byte.

    Mit der Funktion PBgetOVN() kann die Objektbeschreibung eines Objekts auf
    der Zielstation angefordert werden. Die Referenzierung des Objekts erfolgt
    ber den Namen dieses Objekts.
    Die gelesenen Daten der Objektbeschreibung werden in den angegebenen Daten-
    puffer ("data") geschrieben. Der Aufbau und die einzelnen Komponenten
    (Elemente) einer Objektbeschreibung sind im Anhang @650[Objektbeschreibung]
    erkl„rt.






                                     @253[ Fortsetzung ]                   @001[ šbersicht ]
.253
    PBgetOVN - Objektbeschreibung ber Name holen (Fortsetzung)

    Achtung!
    Auf eine Objektbeschreibung kann nicht ber eine Struktur zugegriffen
    werden, da die einzelnen Elemente nicht auf WORD ausgerichtet sind (WORD-
    oder LONG-Elemente k”nnen bei einer ungeraden Adresse beginnen). Der Zugriff
    auf eine Objektbeschreibung ist z.B. ber ein BYTE-Feld m”glich.

    Der Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.










                                    @240[ OV-Management ]                  @001[ šbersicht ]
.255
    PBgetOVN - Objektbeschreibung ber Name holen (Fortsetzung)

    -> Parameter <spec_id   >: BYTE

    Da alle Objekt-Namen auf einer Station nur innerhalb einer Objektgruppe
    eindeutig sind, muá ber den Parameter "spec_id" angegeben werden, welcher
    Objektgruppe das gewnschte Objekt angeh”rt.














                                      @250[ PBgetOVN ]                     @001[ šbersicht ]
.256
    PBgetOVN - Objektbeschreibung ber Name holen (Fortsetzung)

    -> Parameter <long_ver  >: BYTE

    Es kann zwischen zwei Formaten fr die Objektbeschreibung gew„hlt werden:

    Long-Version .... Es werden alle Informationen, die von einem Objekt zur
                      Verfgung stehen, bertragen.
    Short-Version ... Es werden nur die wichtigsten Objekt-Informationen ber-
                      tragen.

    Detaillierte Informationen zum Thema "Long-/Short-Version" finden Sie im
    Anhang @650[Objektbeschreibung].








                                      @250[ PBgetOVN ]                     @001[ šbersicht ]
.260
    PBgetOVM - Objektbeschreibungen mehrerer Objekte holen

    @261[PBgetOVM](enable,kr,startind,adr(ovliste),maxobj,long_ver,adr(data),len,
             ready,error_nr,obj_cnt,morefoll)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, von der eine Objekt-
                                  beschreibung gelesen werden soll.
    ->  startind  : WORD          PROFIBUS-Index, ab dem die Objekt-
                                  beschreibungen von der Zielstation gelesen
                                  werden sollen.
    <-> @265[ovliste   ]: FELD von      Liste von Strukturen, die die einzelnen ge-
                    Strukturen    lesenen Objektbeschreibungen angeben. Das Feld
                                  wird von der Funktion beschrieben, sobald die
                                  Antwort auf den Dienst eingetroffen ist.    


                                     @261[ Fortsetzung ]                   @001[ šbersicht ]
.261
    PBgetOVM - Objektbeschreibungen mehrerer Objekte holen (Fortsetzung)

    ->  maxobj    : BYTE          Maximale Anzahl von Objektbeschreibungen,
                                  die gelesen werden drfen (Liste ist nicht
                                  l„nger!).
    ->  @266[long_ver  ]: BYTE          Es kann zwischen zwei Formaten fr die Objekt-
                                  beschreibung gew„hlt werden:
                                  0 ... Short-Version
                                  1 ... Long-Version
    <-> data      : ALLE          Datenpuffer, in dem die gelesenen Daten
                                  (Objektbeschreibung) abgelegt werden.
                                  Es ist auf jeden Fall gengend Speicher zu
                                  reservieren. Die maximale Gr”áe des Daten-
                                  puffers ist nur durch die maximale L„nge
                                  eines PROFIBUS-Frames (ca. 230 Byte) begrenzt.
    ->  len       : WORD          Gr”áe des Datenpuffers (data) in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  obj_cnt   : BYTE          Anzahl der ausgelesenen Objekte.
    <-  morefoll  : BYTE          Es sind noch weitere Objekte vorhanden.

                                     @262[ Fortsetzung ]                   @001[ šbersicht ]
.262
    PBgetOVM - Objektbeschreibungen mehrerer Objekte holen (Fortsetzung)

    Mit dieser Funktion werden ab dem angegebenen PROFIBUS-Index ("startind")
    mehrere Objektbeschreibungen von der Zielstation angefordert.
    Die gelesenen Daten der Objektbeschreibung werden in den angegebenen Daten-
    puffer ("data") geschrieben. Der Aufbau und die einzelnen Komponenten
    (Elemente) einer Objektbeschreibung sind im Anhang @650[Objektbeschreibung]
    erkl„rt.

    Der Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

    Anmerkung:
    Die Funktion PBgetOVM() ist kein Standard-PROFIBUS-Dienst, d.h. diese
    Funktion kann nur bei B&R-Ger„ten verwendet werden!





                                    @240[ OV-Management ]                  @001[ šbersicht ]
.265
    PBgetOVM - Objektbeschreibungen mehrerer Objekte holen (Fortsetzung)

    <-> Parameter <ovliste   >: FELD von Strukturen

    Feld (Liste) von Strukturen, die die einzelnen gelesenen Objekt-
    beschreibungen angeben. Das Struktur-Feld wird von der Funktion beschrieben,
    sobald die Antwort auf den Dienst eingetroffen ist. Jedes Element des
    Struktur-Feldes enth„lt einen Zeiger auf eine Objektbeschreibung sowie die
    L„nge dieser Objektbeschreibung.
    Format der Struktur:

    ptr        : LONG    Zeiger auf die Daten (Objektbeschreibung)
    len        : BYTE    L„nge dieser Daten (in Byte)
    reserve    : BYTE    Reserve (fr WORD-Ausrichtung)







                                      @260[ PBgetOVM ]                     @001[ šbersicht ]
.266
    PBgetOVM - Objektbeschreibungen mehrerer Objekte holen (Fortsetzung)

    -> Parameter <long_ver  >: BYTE

    Es kann zwischen zwei Formaten fr die Objektbeschreibung gew„hlt werden:

    Long-Version .... Es werden alle Informationen, die von einem Objekt zur
                      Verfgung stehen, bertragen.
    Short-Version ... Es werden nur die wichtigsten Objekt-Informationen ber-
                      tragen.

    Detaillierte Informationen zum Thema "Long-/Short-Version" finden Sie im
    Anhang @650[Objektbeschreibung].








                                      @260[ PBgetOVM ]                     @001[ šbersicht ]
.270
    PROFIBUS-Library - Receive

    Diese Funktionsgruppe enth„lt einen Funktionsblock zum Empfangen von
    Telegrammen:

    @271[PBrec] Telegramme empfangen















                                                                     @001[ šbersicht ]
.271
    PBrec - Telegramme empfangen

    @272[PBrec](enable,adr(par_ptr),ready,error_nr,dat_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    <-> @275[par_ptr   ]: par-Struktur  Struktur, in der die Parameter des empfan-
                                  genen Dienstes abgelegt werden. Abh„ngig
                                  vom empfangenen Dienst k”nnen die Parameter
                                  unterschiedlich sein.
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  @279[dat_ptr   ]: LONG          Zeiger auf die Daten, die mit dem Dienst
                                  empfangen wurden.

    Mit dieser Funktion k”nnen PROFIBUS-Dienste empfangen werden.

                                     @272[ Fortsetzung ]                   @001[ šbersicht ]
.272
    PBrec - Telegramme empfangen (Fortsetzung)

    Ab der Version 2.00 der PROFIBUS-Library (siehe auch Anhang @900[History])
    k”nnen mit dieser Funktion nicht nur Layer7-Dienste, sondern auch
    Layer2-Dienste empfangen werden.

    Die Funktion PBrec() wartet auf den Empfang eines PROFIBUS-Dienstes und
    liefert einen Zeiger auf die empfangenen Daten. Die Auswertung der emp-
    fangenen Information wird in zwei Teile gegliedert:

    - Parameter (Ein-/Ausgangsparameter "@275[par_ptr]")
    - Daten (Ausgangsparameter "@279[dat_ptr]")









                                     @273[ Fortsetzung ]                   @001[ šbersicht ]
.273
    PBrec - Telegramme empfangen (Fortsetzung)

    Anmerkungen:
    - Die Auswertung der empfangenen Daten muá vor der n„chsten Aktivierung
      des Funktionsblocks ("enable" = 1) erfolgen. Mit der n„chsten Aktivierung
      des Funktionsblocks werden diese Daten gel”scht und der Funktionsblock
      wird wieder auf Empfang geschaltet!
    - Fr die empfangenen Daten braucht kein Speicher zur Verfgung gestellt
      werden, da der Ausgangsparameter "dat_ptr" direkt auf die zugeh”rigen
      Daten im DPR des Netzwerk-Controllers zeigt.
    - Auf die Daten darf nur lesend zugegriffen werden!
    - Falls notwendig, kann mit mehreren Funktionsbl”cken gleichzeitig
      empfangen werden.








                                       @270[ Receive ]                     @001[ šbersicht ]
.275
    PBrec - Telegramme empfangen (Fortsetzung)

    <-> Parameter <par_ptr   >: par-Struktur

    Die Parameter des empfangenen Dienstes werden in einer Struktur abgelegt.
    Abh„ngig vom empfangenen Dienst k”nnen die Parameter unterschiedlich sein:

    @276[Parameter eines Layer2-Dienstes]
    @278[Parameter eines Layer7-Dienstes]

    Mit Hilfe des Elements "service_id" der Struktur kann festgestellt werden,
    ob ein Layer2- oder ein Layer7-Dienst empfangen wurde.









                                                                     @001[ šbersicht ]
.276
    PBrec - Telegramme empfangen (Fortsetzung)

    Fr Layer2-Dienste haben die Elemente der Struktur folgende Bedeutung:

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls.
    sa         : BYTE   Adresse des Absenders.
    service_id : BYTE   Id-Nummer des empfangenen Layer2-Dienstes.
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   Destination-SAP. Kommunikationskanal (SAP) auf der
                        Zielstation.
    prio       : BYTE   Priorit„t (0=LOW, 1=HIGH) des Dienstes.
    send_len   : BYTE   immer 0
    rec_len    : BYTE   L„nge der empfangenen Daten.
    dummy1     : BYTE   nicht verwendet
    dummy2     : BYTE   nicht verwendet
    dummy3     : BYTE   nicht verwendet
    dummy4     : BYTE   nicht verwendet
    dummy5     : BYTE   nicht verwendet
    dummy6     : BYTE   nicht verwendet

                                     @277[ Fortsetzung ]                   @001[ šbersicht ]
.277
    PBrec - Telegramme empfangen (Fortsetzung)

    Fr Layer2-Dienste haben die Elemente der Struktur folgende Bedeutung
    (Fortsetzung):

    dummy7     : BYTE   nicht verwendet
    dummy8     : BYTE   nicht verwendet

    Die Werte der Strukturelemente "sa", "service_id", "ssap", "dsap", "prio"
    und "rec_len" sind erst gltig, wenn der Ausgangsparameter "ready" = 1 ist.











                                       @275[ Zurck ]                      @001[ šbersicht ]
.278
    PBrec - Telegramme empfangen (Fortsetzung)

    Fr Layer7-Dienste haben die Elemente der Struktur folgende Bedeutung:

    kr         : WORD   Verbindungsnummer, auf der empfangen wurde
                        (Kommunikationsreferenz).
    service_id : BYTE   Identifiziert den empfangenen Layer7-Dienst.
                        Z.B. Dienst PBirepl(): "service_id" = 0
    reserve    : BYTE   nicht verwendet
    len        : WORD   L„nge der Daten ("dat_ptr").
    index      : WORD   Index des empfangenen Dienstes.
    sub_index  : WORD   Subindex des empfangenen Dienstes.
    dummy1     : WORD   nicht verwendet
    dummy2     : WORD   nicht verwendet
    dummy3     : WORD   nicht verwendet






                                       @275[ Zurck ]                      @001[ šbersicht ]
.279
    PBrec - Telegramme empfangen (Fortsetzung)

    <- Parameter <dat_ptr   >: LONG

    Der Ausgangsparameter "dat_ptr" verweist auf die Daten, die mit dem Dienst
    empfangen wurden. Der Zeiger verweist direkt ins DPR (Dual Ported RAM) des
    Netzwerk-Controllers.

    Achtung!
    Das DPR des Netzwerk-Controllers ist nicht nullspannungssicher!











                                        @271[ PBrec ]                      @001[ šbersicht ]
.280
    PROFIBUS-Library - Send

    Diese Funktionsgruppe enth„lt einen Funktionsblock zum Senden von
    Telegrammen:

    @281[PBsend] Telegramme senden















                                                                     @001[ šbersicht ]
.281
    PBsend - Telegramme senden

    @282[PBsend](enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @285[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Sendedaten. Sind keine Sendedaten vorhanden,
                                  kann der Wert 0 bergeben werden.
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Zeiger auf die Empfangsdaten (falls der
                                  aktivierte Dienst welche liefert).



                                     @282[ Fortsetzung ]                   @001[ šbersicht ]
.282
    PBsend - Telegramme senden (Fortsetzung)

    Der Funktionsblock PBsend() aktiviert einen Layer2-Dienst. Der Funktions-
    block muá so lange aufgerufen werden, bis der Ausgang "ready" = 1 ist
    (Auftrag erfolgreich abgeschlossen) oder am Ausgang "error_nr" eine Fehler-
    nummer ausgegeben wird.
    Der Funktionsblock sendet den Layer2-Request und muá dann so lange gepollt
    werden, bis er die Layer2-Confirmation empfangen hat. Diese liefert z.B.
    im Fall des SRD-Dienstes Antwortdaten zurck, auf die direkt zugegriffen
    werden kann.

    šber den Funktionsblock sind auch Layer2-Management-Dienste aktivierbar,
    die z.B. das Auslesen der Life-List erm”glichen.








                                     @283[ Fortsetzung ]                   @001[ šbersicht ]
.283
    PBsend - Telegramme senden (Fortsetzung)

    Anmerkung:
    Die genaue Bedeutung der einzelnen Parameter sowie alle m”glichen Dienste
    sind im folgenden beschrieben:

    @290[SAP_ACTIVATE    ] Service Access Point Activate
    @300[SDA             ] Send Data with Acknowledge
    @310[SDN             ] Send Data with no Acknowledge
    @320[SRD             ] Send and Request Data
    @330[REPLY_UPDATE    ] Reply Update
    @340[LIFE_LIST_CREATE] Life List Create









                                        @280[ Send ]                       @001[ šbersicht ]
.285
    PBsend - Telegramme senden (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    Die Parameter des empfangenen Dienstes werden in der Struktur "par"
    abgelegt. Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls
                        (wird nur beim ersten Durchlauf ausgewertet).
    da         : BYTE   Adresse der Zielstation.
    service_id : BYTE   Id-Nummer des gewnschten Dienstes.
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   Destination-SAP. Kommunikationskanal (SAP) auf der
                        Zielstation.
    prio       : BYTE   Priorit„t (0=LOW, 1=HIGH) des Dienstes.
    send_len   : BYTE   L„nge der Sendedaten.
    rec_len    : BYTE   L„nge der empfangenen Daten.



                                       @281[ PBsend ]                      @001[ šbersicht ]
.290
    SAP_ACTIVATE - Service Access Point Activate

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @295[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Fr den Dienst SAP_ACTIVATE muá hier der
                                  Wert 0 bergeben werden.
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @299[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Dieser Dienst liefert keine Empfangsdaten.

    Dieser Aufruf aktiviert einen Layer2-SAP (SAP = Service Access Point) fr
    Zugriffe von Remote-Stationen bzw. fr die Abwicklung von Sende-Diensten.

                                     @291[ Fortsetzung ]                   @001[ šbersicht ]
.291
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    Wird kein SAP konfiguriert, ist kein Datenaustausch mit einer Remote-
    Station m”glich. Alle Dienstaufrufe werden mit einer Fehlermeldung ab-
    gewiesen.
    Bei der SAP-Konfigurierung kann angegeben werden, welche Dienste ber
    diesen SAP abgewickelt werden sollen. Dies kann fr Sende- und Empfangs-
    richtung getrennt angegeben werden. Wird z.B. ein SAP nur fr das Senden
    eingerichtet, werden Telegramme, die von einer Remote-Station an die
    lokale Station gesendet werden, bereits im Layer2 abgewiesen.











    @281[ PBsend ]                        @290[ SAP_ACTIVATE ]                   @001[ šbersicht ]
.295
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls.
    da         : BYTE   Zugriffsschutz:
                        $7F ......... Alle Remote-Stationen k”nnen auf diesen
                                      SAP zugreifen.
                        0 bis 126 ... Nur die jeweils angegebene Station darf
                                      auf diesen SAP zugreifen.
    service    : BYTE   SAP_ACTIVATE = 1
    ssap       : BYTE   MSAP         = 1
    dsap       : BYTE   SAP, der aktiviert werden soll.
    @296[prio       ]: BYTE   Angabe der Dienste, die ber diesen Layer2-SAP abge-
                        wickelt werden k”nnen.
    send_len   : BYTE   0
    rec_len    : BYTE   0

    @298[ Beispiel ]                      @290[ SAP_ACTIVATE ]                   @001[ šbersicht ]
.296
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    Die erlaubten Dienste werden ber das Element "prio" eingestellt:

    BIT  7 6 5 4 3 2 1 0
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³x³0³x³x³x³x³x³x³
        ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ³   ³ ³ ³ ³ ³ ÀÄÄÄÄ SDA senden      (1=enabled, 0=disabled)
         ³   ³ ³ ³ ³ ÀÄÄÄÄÄÄ SDA empfangen   (1=enabled, 0=disabled)
         ³   ³ ³ ³ ÀÄÄÄÄÄÄÄÄ SDN senden      (1=enabled, 0=disabled)
         ³   ³ ³ ÀÄÄÄÄÄÄÄÄÄÄ SDN empfangen   (1=enabled, 0=disabled)
         ³   ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄ SRD senden      (1=enabled, 0=disabled)
         ³   ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄ SRD empfangen   (1=enabled, 0=disabled)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ @297[SRD BUFFER Mode] (1=on, 0=off)

    Mit Hilfe des Elements "da" kann darber hinaus ein Zugriffsschutz reali-
    siert werden, der es nur einer Remote-Station erlaubt, auf diesen lokalen
    SAP zuzugreifen. Wird fr das Element "da" der Wert $7F eingetragen,
    drfen alle Remote-Stationen auf diesen SAP zugreifen.

                                       @295[ Zurck ]                      @001[ šbersicht ]
.297
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    SRD BUFFER Mode:
    1=on .... Ein empfangener SRD-Dienst wird nicht ber den FUB PBrec() aus-
              gelesen, sondern auf dem PROFIBUS Netzwerkmodul (SAP) zwischen-
              gespeichert, und kann dann ber den Dienst REPLY UPDATE ausge-
              lesen werden. Trifft ein neuer SRD-Dienst ein, bevor der letzte
              abgeholt wurde, ersetzt der neue SRD-Dienst den alten.
    0=off ... Dienst wird wie alle anderen Dienste dem FUB PBrec() zugefhrt.












                                       @296[ Zurck ]                      @001[ šbersicht ]
.298
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    Beispiel:

       mod_nr   = 1
       da       = $7F
       service  = 1     (Service Access Point Activate)
       ssap     = 1
       dsap     = 50
       prio     = $3F   ($3F = 00111111)
       send_len = 0
       rec_len  = 0

    Ein Aufruf mit diesen Werten aktiviert den SAP 50, erlaubt allen Remote-
    Stationen den Zugriff auf diesen SAP und gibt die SDA-, SDN- und SRD-
    Dienste fr das Senden und Empfangen frei.





                                       @295[ Zurck ]                      @001[ šbersicht ]
.299
    SAP_ACTIVATE - Service Access Point Activate (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich abgewickelt
    4923    Parameter ungltig
    4926    SAP ist bereits konfiguriert













                                    @290[ SAP_ACTIVATE ]                   @001[ šbersicht ]
.300
    SDA - Send Data with Acknowledge

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @305[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Sendedaten
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @307[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Dieser Dienst liefert keine Empfangsdaten.

    Dieser Aufruf l”st das Senden eines SDA-Dienstes aus.



                                     @301[ Fortsetzung ]                   @001[ šbersicht ]
.301
    SDA - Send Data with Acknowledge (Fortsetzung)

    Das Element "ssap" der Struktur "par" gibt den lokalen SAP, ber den der
    Dienst abgewickelt werden soll, an (dieser SAP muá zuvor mit dem Dienst
    SAP_ACTIVATE fr den Dienst SDA senden aktiviert werden).
    Das Element "dsap" gibt den SAP auf der Remote-Station (ber den der Dienst
    dort geleitet werden soll) an. Auf der Remote-Station muá dieser SAP fr
    den Dienst SDA empfangen aktiviert worden sein.
    Dieser Dienst sendet einen Frame, der vom Layer2 der Remote-Station be-
    st„tigt wird. Erfolgt keine Best„tigung durch die Remote-Station, wird der
    Dienst von der lokalen Station wiederholt (die Anzahl der Wiederholungen
    ist durch Layer2-Busparameter einstellbar).
    Der Ausgang "error_nr" des SDA-Dienstes gibt an, ob die Sendung erfolgreich
    war.







    @281[ PBsend ]                             @300[ SDA ]                       @001[ šbersicht ]
.305
    SDA - Send Data with Acknowledge (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls.
    da         : BYTE   Adresse der Remote-Station.
    service    : BYTE   SDA = 48
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   Destination-SAP. Kommunikationskanal (SAP) auf der
                        Zielstation.
    prio       : BYTE   0 = PRIO_LOW
                        1 = PRIO_HIGH
    send_len   : BYTE   L„nge der Sendedaten.
    rec_len    : BYTE   0



    @306[ Beispiel ]                           @300[ SDA ]                       @001[ šbersicht ]
.306
    SDA - Send Data with Acknowledge (Fortsetzung)

    Beispiel:

       mod_nr   = 1
       da       = 3
       service  = 48    (Send Data with Acknowledge)
       ssap     = 50
       dsap     = 50
       prio     = 0
       send_len = 3
       rec_len  = 0

    Ein Aufruf mit diesen Werten sendet einen SDA-Dienst mit niedriger Prio-
    rit„t und 3 Byte Sendedaten an die Station 3 (ber den lokalen SAP 50 an
    den remote SAP 50).





                                       @305[ Zurck ]                      @001[ šbersicht ]
.307
    SDA - Send Data with Acknowledge (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich abgewickelt
            (Acknowledge von Remote-Station erhalten)
    4923    Wert fr Element "da" nicht gltig
            Wert fr Element "dsap" nicht gltig
            Wert fr Element "ssap" nicht gltig
            Wert fr Element "send_len" zu groá
    4925    Source-SAP (lokaler SAP) ist fr den Dienst SDA senden nicht
            konfiguriert
    4927    Die lokale Station ist nicht im logischen Token-Ring
    4928    Keine oder keine plausible Reaktion der Remote-Station
    4931    Negative Quittung (Remote User/FDL Schnittstellenfehler)
    4932    Negative Quittung (Betriebsmittel der Remote-FDL Steuerung nicht
            verfgbar oder nicht ausreichend)
    4933    Dienst oder Remote-Adresse beim Destination-SAP (remote SAP) nicht
            aktiviert

                                         @300[ SDA ]                       @001[ šbersicht ]
.310
    SDN - Send Data with no Acknowledge

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @315[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Sendedaten
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @316[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Dieser Dienst liefert keine Empfangsdaten.

    Dieser Aufruf l”st das Senden eines SDN-Dienstes aus.



                                     @311[ Fortsetzung ]                   @001[ šbersicht ]
.311
    SDN - Send Data with no Acknowledge (Fortsetzung)

    Das Element "ssap" der Struktur "par" gibt den lokalen SAP, ber den der
    Dienst abgewickelt werden soll, an (dieser SAP muá zuvor mit dem Dienst
    SAP_ACTIVATE fr den Dienst SDN senden aktiviert werden).
    Das Element "dsap" gibt den SAP auf der Remote-Station (ber den der Dienst
    dort geleitet werden soll) an. Auf der Remote-Station muá dieser SAP fr
    den Dienst SDN empfangen aktiviert worden sein.
    Dieser Dienst sendet einen Frame, der vom Layer2 der Remote-Station nicht
    best„tigt wird. Damit hat man keine Gew„hr, daá der Dienst beim Empf„nger
    angekommen ist. Der SDN-Dienst ist der einzige Layer2-Dienst der im
    Broadcast bzw. Multicast gesendet werden darf.

    Multicast: Durch Angabe von da=127 und dsap=xxx wird der SDN-Dienst an alle
               anderen Teilnehmer, die den SAP xxx fr SDN empfangen aktiviert
               haben, gesendet.
    Broadcast: Ist ein Spezialfall des Multicast bei dem dsap=63 vorgegeben
               ist.



    @281[ PBsend ]                             @310[ SDN ]                       @001[ šbersicht ]
.315
    SDN - Send Data with no Acknowledge (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls.
    da         : BYTE   Adresse der Remote-Station.
    service    : BYTE   SDN = 49
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   Destination-SAP. Kommunikationskanal (SAP) auf der
                        Zielstation.
    prio       : BYTE   0 = PRIO_LOW
                        1 = PRIO_HIGH
    send_len   : BYTE   L„nge der Sendedaten.
    rec_len    : BYTE   0



                                         @310[ SDN ]                       @001[ šbersicht ]
.316
    SDN - Send Data with no Acknowledge (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich gesendet
    4923    Wert fr Element "da" nicht gltig
            Wert fr Element "dsap" nicht gltig
            Wert fr Element "ssap" nicht gltig
            Wert fr Element "send_len" zu groá
    4925    Source-SAP (lokaler SAP) ist fr den Dienst SDN senden nicht
            konfiguriert
    4927    Die lokale Station ist nicht im logischen Token-Ring








                                         @310[ SDN ]                       @001[ šbersicht ]
.320
    SRD - Send and Request Data

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @325[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Sendedaten
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @326[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Zeiger auf die empfangenen Daten.

    Dieser Aufruf l”st das Senden eines SRD-Dienstes aus.



                                     @321[ Fortsetzung ]                   @001[ šbersicht ]
.321
    SRD - Send and Request Data (Fortsetzung)

    Das Element "ssap" der Struktur "par" gibt den lokalen SAP, ber den der
    Dienst abgewickelt werden soll, an (dieser SAP muá zuvor mit dem Dienst
    SAP_ACTIVATE fr den Dienst SRD senden aktiviert werden).
    Das Element "dsap" gibt den SAP auf der Remote-Station (von dem die
    Empfangsdaten ausgelesen werden sollen) an. Auf der Remote-Station muá
    dieser SAP fr den Dienst SRD empfangen aktiviert worden sein. Weiters
    mssen (bzw. k”nnen) auf der Remote-Station mit dem REPLY_UPDATE-Dienst
    Daten zur Abholung bereitgestellt worden sein.
    Dieser Dienst sendet einen Frame, der vom Layer2 der Remote-Station be-
    st„tigt wird (mit der Best„tigung k”nnen Daten bertragen werden).
    Erfolgt keine Best„tigung durch die Remote-Station, wird der Dienst von
    der lokalen Station wiederholt (die Anzahl der Wiederholungen ist durch
    Layer2-Busparameter einstellbar). Der Ausgang "error_nr" des SRD-Dienstes
    gibt an, ob die Sendung erfolgreich war.
    Mit Hilfe dieses Layer2-Dienstes k”nnen in einem Nachrichtenzyklus Daten
    gesendet und empfangen werden.



    @281[ PBsend ]                             @320[ SRD ]                       @001[ šbersicht ]
.325
    SRD - Send and Request Data (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls.
    da         : BYTE   Adresse der Remote-Station.
    service    : BYTE   SRD = 50
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   Destination-SAP. Kommunikationskanal (SAP) auf der
                        Zielstation.
    prio       : BYTE   0 = PRIO_LOW
                        1 = PRIO_HIGH
    send_len   : BYTE   L„nge der Sendedaten.
    rec_len    : BYTE   L„nge der empfangenen Daten.



                                         @320[ SRD ]                       @001[ šbersicht ]
.326
    SRD - Send and Request Data (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich abgewickelt
            Acknowledge von Remote-Station erhalten:
            "rec_len" = 0 ................ Sendedaten OK, keine Antwortdaten
                                           vorhanden
            "rec_len" <> 0, "prio" = 0 ... Sendedaten OK, Antwortdaten mit
                                           niedriger Priorit„t vorhanden
            "rec_len" <> 0, "prio" = 1 ... Sendedaten OK, Antwortdaten mit
                                           hoher Priorit„t vorhanden
    4923    Wert fr Element "da" nicht gltig
            Wert fr Element "dsap" nicht gltig
            Wert fr Element "ssap" nicht gltig
            Wert fr Element "send_len" zu groá
    4925    Source-SAP (lokaler SAP) ist fr den Dienst SRD senden nicht
            konfiguriert
    4927    Die lokale Station ist nicht im logischen Token-Ring

                                     @327[ Fortsetzung ]                   @001[ šbersicht ]
.327
    SRD - Send and Request Data (Fortsetzung)

    4928    Keine oder keine plausible Reaktion der Remote-Station
    4931    Negative Quittung (Remote User/FDL Schnittstellenfehler)
    4932    Negative Quittung (Betriebsmittel der Remote-FDL Steuerung nicht
            verfgbar oder nicht ausreichend)
    4933    Dienst oder Remote-Adresse beim Destination-SAP (remote SAP) nicht
            aktiviert
    4939    Positive Quittung fr Sendedaten; Negative Quittung fr Empfangs-
            daten (da bei Remote-Station nicht vorhanden)
    4942    Negative Quittung fr Sendedaten (da Betriebsmittel der Remote-
            Station nicht verfgbar oder nicht ausreichend); Empfangsdaten
            niederprior vorhanden
    4942    Negative Quittung fr Sendedaten (da Betriebsmittel der Remote-
            Station nicht verfgbar oder nicht ausreichend); Empfangsdaten
            hochprior vorhanden





                                         @320[ SRD ]                       @001[ šbersicht ]
.330
    REPLY_UPDATE - Reply Update

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @335[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          Sendedaten
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @336[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).
    <-  rec_ptr   : LONG          Wenn der SAP fr den @296[SRD BUFFER Mode] konfi-
                                  guriert ist (siehe Dienst SAP_ACTIVATE) und
                                  ein SRD-Dienst empfangen wurde, enth„lt der
                                  Ausgang rec_ptr nach dem REPLY_UPDATE-Aufruf
                                  einen Zeiger auf die empfangenen Daten.

                                     @331[ Fortsetzung ]                   @001[ šbersicht ]
.331
    REPLY_UPDATE - Reply Update (Fortsetzung)

    Dieser Dienst legt neue Sendedaten im Reply-Puffer des angegebenen SAP ab
    und holt empfangene Daten ab (falls der SAP fr den @296[SRD BUFFER Mode]
    konfiguriert ist). Die abgelegten Sendedaten k”nnen von einer Remote-
    Station mit dem SRD-Dienst ausgelesen werden.
    Das Element "ssap" der Struktur "par" gibt den lokalen SAP, dessen Puffer
    aktualisiert werden soll, an (dieser SAP muá zuvor mit dem Dienst
    SAP_ACTIVATE fr den Dienst SRD empfangen aktiviert werden).

    Mit REPLY_UPDATE_SINGLE wird der Datenpuffer fr das einmalige Auslesen
    durch eine Remote-Station bergeben. Bei weiteren Zugriffen der Remote-
    Station (mittels des SRD-Dienstes) auf diesen SAP werden keine Antwort-
    daten mehr bertragen.
    Mit REPLY_UPDATE_MULTIPLE wird der Datenpuffer fr das mehrmalige Auslesen
    durch eine Remote-Station bergeben. Bei weiteren Zugriffen der Remote-
    Station (mittels des SRD-Dienstes) auf diesen SAP werden diese Daten erneut
    bertragen.



                                     @332[ Fortsetzung ]                   @001[ šbersicht ]
.332
    REPLY_UPDATE - Reply Update (Fortsetzung)

    Anmerkung:
    Mit dem Dienst REPLY_UPDATE k”nnen ausschlieálich niederpriore Telegramme
    an einem SAP abgelegt werden.
















    @281[ PBsend ]                        @330[ REPLY_UPDATE ]                   @001[ šbersicht ]
.335
    REPLY_UPDATE - Reply Update (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls
    da         : BYTE   0 (nicht verwendet)
    service    : BYTE   REPLY_UPDATE_SINGLE = 54
                        REPLY_UPDATE_MULTIPLE = 55
    ssap       : BYTE   Source-SAP. Kommunikationskanal (SAP) auf der
                        lokalen Station.
    dsap       : BYTE   0 (nicht verwendet)
    prio       : BYTE   0
    send_len   : BYTE   L„nge der Sendedaten.
    rec_len    : BYTE   L„nge der Empfangsdaten.




                                    @330[ REPLY_UPDATE ]                   @001[ šbersicht ]
.336
    REPLY_UPDATE - Reply Update (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich abgewickelt
    4923    Wert fr Element "ssap" nicht gltig
            Wert fr Element "send_len" zu groá
    4925    Source-SAP (lokaler SAP) ist fr den Dienst SRD empfangen nicht
            konfiguriert











                                    @330[ REPLY_UPDATE ]                   @001[ šbersicht ]
.340
    LIFE_LIST_CREATE - Life List Create

    PBsend(enable,adr(par_ptr),adr(send_ptr),ready,error_nr,rec_ptr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  @345[par_ptr   ]: par-Struktur  In diese Struktur mssen die Parameter des
                                  Dienstes eingetragen werden.
    ->  send_ptr  : LONG          BYTE-Feld, das die Nummern der Stationen
                                  (Stationsnummern), deren Life-Status bestimmt
                                  werden soll, enth„lt.
    <-  ready     : BIT           0 ... Der FUB ist noch nicht fertig (oder
                                        Fehler aufgetreten).
                                  1 ... Der FUB hat den Auftrag fehlerfrei
                                        erledigt.
    <-  @346[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).




                                     @341[ Fortsetzung ]                   @001[ šbersicht ]
.341
    LIFE_LIST_CREATE - Life List Create (Fortsetzung)

    <-  rec_ptr   : LONG          Zeiger auf ein BYTE-Feld, das den Status der
                                  jeweiligen Stationen (siehe Eingangsparameter
                                  send_ptr) enth„lt. Es werden send_len Status-
                                  Bytes eingetragen.

    Dieser Dienst bestimmt den Life-Status der (ber die Stationsnummern)
    angegebenen Stationen. Pro Station wird ein Byte abgelegt, das folgende
    Information beinhaltet:

    0 ..... passiver Teilnehmer
    1 ..... aktiver Teilnehmer nicht bereit
    2 ..... aktiver Teilnehmer bereit fr den logischen Token-Ring
    3 ..... aktiver Teilnehmer im logischen Token-Ring
    $80 ... Station nicht vorhanden





    @281[ PBsend ]                      @340[ LIFE_LIST_CREATE ]                 @001[ šbersicht ]
.345
    LIFE_LIST_CREATE - Life List Create (Fortsetzung)

    -> Parameter <par_ptr   >: par-Struktur

    In diese Struktur mssen die Parameter des Dienstes eingetragen werden.
    Elemente der Struktur "par":

    mod_nr     : BYTE   Modulnummer des PROFIBUS Netzwerkmoduls
    da         : BYTE   0
    service    : BYTE   LIFE_LIST_CREATE = 26
    ssap       : BYTE   MSAP = 1
    dsap       : BYTE   0
    prio       : BYTE   0
    send_len   : BYTE   L„nge des BYTE-Feldes "send_ptr" (Anzahl der Stationen,
                        deren Life-Status bestimmt werden soll)
    rec_len    : BYTE   L„nge der Empfangsdaten





                                  @340[ LIFE_LIST_CREATE ]                 @001[ šbersicht ]
.346
    LIFE_LIST_CREATE - Life List Create (Fortsetzung)

    <- Parameter <error_nr  >: WORD

    Fehlernummern:
    0       Dienst erfolgreich abgewickelt
    4923    Wert fr Element "ssap" nicht gltig
    4924    Betriebsmittel der lokalen FDL Steuerung nicht verfgbar oder
            nicht ausreichend












                                  @340[ LIFE_LIST_CREATE ]                 @001[ šbersicht ]
.400
    PROFIBUS-Library - Information Report

    Diese Funktionsgruppe enth„lt eine Funktion zum Senden von Daten-
    Telegrammen:

    @401[PBirepI] Information Report per Index















                                                                     @001[ šbersicht ]
.401
    PBirepI - Information Report per Index

    @402[PBirepI](enable,kr,index,subindex,adr(data),len,ready error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]) der
                                  Zielstation.
    ->  @405[index     ]: WORD          PROFIBUS-Index der Variable, die ausgesendet
                                  wird. Der PROFIBUS-Index kann mit der Funktion
                                  @250[PBgetOVN] ermittelt werden.
    ->  @406[subindex  ]: WORD          Subindex der Variable, die ausgesendet wird.
    ->  data      : ALLE          Variable, die ausgesendet wird.
    ->  len       : WORD          L„nge der Daten (data) in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).



                                     @402[ Fortsetzung ]                   @001[ šbersicht ]
.402
    PBirepI - Information Report per Index (Fortsetzung)

    Mit der Funktion PBirepI() kann ein Information-Report-Dienst (per PROFIBUS-
    Index) ber die logische Verbindungsnummer "kr" abgesetzt werden. D.h. die
    Funktion PBirepI() erm”glicht das Senden von Daten-Telegrammen an die
    definierte PROFIBUS-Station (Parameter "kr"). Die zu sendenden Daten mssen
    im Datenpuffer "data" abgelegt werden. Der Parameter "len" gibt die L„nge
    der Daten an.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.









                                 @400[ Information Report ]                @001[ šbersicht ]
.405
    PBirepI - Information Report per Index (Fortsetzung)

    -> Parameter <index     >: WORD

    Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden.
    Diese Funktion liefert die @650[Objektbeschreibung] eines Objekts auf der Ziel-
    station. Das erste Element (Element "Index", Datentyp WORD) dieser Objekt-
    beschreibung enth„lt den Index des Objekts.













                                       @401[ PBirepI ]                     @001[ šbersicht ]
.406
    PBirepI - Information Report per Index (Fortsetzung)

    -> Parameter <subindex  >: WORD

    @542[Subindex] der Variable, die ausgesendet wird.
















                                       @401[ PBirepI ]                     @001[ šbersicht ]
.410
    PROFIBUS-Library - Status senden

    Diese Funktionsgruppe enth„lt eine Funktion zum Senden eines Status-
    Telegramms:

    @411[PBustat] Status-Telegramm absetzen















                                                                     @001[ šbersicht ]
.411
    PBustat - Status-Telegramm absetzen

    @412[PBustat](enable,kr,log_stat,phy_stat,adr(ld_ptr),ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]) der
                                  Zielstation.
    ->  log_stat  : BYTE          Logischer Status.
    ->  phy_stat  : BYTE          Physikalischer Status.
    ->  ld_ptr    : BYTE (FELD)   Local Detail (Detail-Informationen). Es werden
                                  Detail-Informationen mit einer L„nge von drei
                                  Byte erwartet. Wird fr adr(ld_ptr) der Wert 0
                                  angegeben, werden keine Detail-Informationen
                                  gesendet.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).


                                     @412[ Fortsetzung ]                   @001[ šbersicht ]
.412
    PBustat - Status-Telegramm absetzen (Fortsetzung)

    Mit der Funktion PBustat() wird ein Unsolicited-Status-Dienst auf der ent-
    sprechenden Verbindung abgesetzt.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.













                                    @410[ Status senden ]                  @001[ šbersicht ]
.420
    PROFIBUS-Library - Download-Dienste

    Mit den Funktionen der Funktionsgruppe Download-Dienste k”nnen B&R-Module
    auf eine andere PROFIBUS-Station bertragen werden:

    @421[PBdlI] Download per Index
    @430[PBdlN] Download per Name














                                                                     @001[ šbersicht ]
.421
    PBdlI - Download per Index

    @422[PBdlI](enable,kr,index,modptr,modlen,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, auf die das B&R-Modul ge-
                                  laden werden soll.
    ->  @425[index     ]: WORD          PROFIBUS-Index des Speicherbereichs (Domain)
                                  auf der Zielstation, in den das B&R-Modul
                                  bertragen werden soll.
    ->  modptr    : LONG          Physikalische Adresse des B&R-Moduls
                                  (Programm-Modul oder Datenmodul), das auf die
                                  Zielstation geladen werden soll. Die physi-
                                  kalische Adresse eines B&R-Moduls kann z.B.
                                  mit der Funktion MO_list() (siehe BURTRAP-
                                  Library) ermittelt werden.

                                     @422[ Fortsetzung ]                   @001[ šbersicht ]
.422
    PBdlI - Download per Index (Fortsetzung)

    ->  modlen    : LONG          Gesamtl„nge des B&R-Moduls in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit der Funktion PBdlI() kann ein B&R-Modul auf die Zielstation bertragen
    werden. Die Referenzierung des Speicherbereichs (Domain) auf der Ziel-
    station, in den das B&R-Modul bertragen wird, erfolgt ber den PROFIBUS-
    Index dieses Speicherbereichs.

    Ein "Domain" ist ein Objekt, das einen logisch zusammenh„ngenden Speicher-
    bereich von einer maximal festgelegten L„nge enth„lt. Der Speicherbereich
    kann entweder Daten oder Programme enthalten.







                                     @423[ Fortsetzung ]                   @001[ šbersicht ]
.423
    PBdlI - Download per Index (Fortsetzung)

    Bei Datenmodulen kann die physikalische Adresse (Parameter "modptr") und die
    Gesamtl„nge (Parameter "modlen") z.B. mit Hilfe der Funktionen DA_ident()
    und DA_info() der B&R-TRAP-Library ermittelt werden:

      Err_Id = DA_ident(adr(Name),0,adr(Ident))
      Err_In = DA_info(Ident,adr(D_Adr),adr(D_Len),adr(Typ))
      ; D_Adr - $50 (fr Modulheader) = physikalische Adresse des Datenmoduls
      modptr = D_Adr - $50
      ; D_Len + $50 (fr Modulheader) = Gesamtl„nge des Datenmoduls
      modlen = D_Len + $50

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.





                                  @420[ Download-Dienste ]                 @001[ šbersicht ]
.425
    PBdlI - Download per Index (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index des Speicherbereichs (Domain), in den das B&R-Modul ber-
    tragen wird. Dieser Index kann ber die Funktion @250[PBgetOVN] ermittelt werden.















                                        @421[ PBdlI ]                      @001[ šbersicht ]
.430
    PBdlN - Download per Name

    @431[PBdlN](enable,kr,adr(modname),modptr,modlen,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]). Gibt
                                  die Zielstation an, auf die das B&R-Modul ge-
                                  laden werden soll.
    ->  @435[modname   ]: BYTE (FELD)   PROFIBUS-Name des Speicherbereichs (Domain)
                                  auf der Zielstation, in den das B&R-Modul
                                  bertragen werden soll.
    ->  modptr    : LONG          Physikalische Adresse des B&R-Moduls
                                  (Programm-Modul oder Datenmodul), das auf die
                                  Zielstation geladen werden soll. Die physi-
                                  kalische Adresse eines B&R-Moduls kann z.B.
                                  mit der Funktion MO_list() (siehe BURTRAP-
                                  Library) ermittelt werden.

                                     @431[ Fortsetzung ]                   @001[ šbersicht ]
.431
    PBdlN - Download per Name (Fortsetzung)

    ->  modlen    : LONG          Gesamtl„nge des B&R-Moduls in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit der Funktion PBdlN() kann ein B&R-Modul auf die Zielstation bertragen
    werden. Die Referenzierung des Speicherbereichs (Domain) auf der Ziel-
    station, in den das B&R-Modul bertragen wird, erfolgt ber den PROFIBUS-
    Namen dieses Speicherbereichs.

    Ein "Domain" ist ein Objekt, das einen logisch zusammenh„ngenden Speicher-
    bereich von einer maximal festgelegten L„nge enth„lt. Der Speicherbereich
    kann entweder Daten oder Programme enthalten.







                                     @432[ Fortsetzung ]                   @001[ šbersicht ]
.432
    PBdlN - Download per Name (Fortsetzung)

    Bei Datenmodulen kann die physikalische Adresse (Parameter "modptr") und die
    Gesamtl„nge (Parameter "modlen") z.B. mit Hilfe der Funktionen DA_ident()
    und DA_info() der B&R-TRAP-Library ermittelt werden:

      Err_Id = DA_ident(adr(Name),0,adr(Ident))
      Err_In = DA_info(Ident,adr(D_Adr),adr(D_Len),adr(Typ))
      ; D_Adr - $50 (fr Modulheader) = physikalische Adresse des Datenmoduls
      modptr = D_Adr - $50
      ; D_Len + $50 (fr Modulheader) = Gesamtl„nge des Datenmoduls
      modlen = D_Len + $50

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.





                                  @420[ Download-Dienste ]                 @001[ šbersicht ]
.435
    PBdlN - Download per Name (Fortsetzung)

    -> Parameter <modname   >: BYTE (FELD)

    PROFIBUS-Name des Speicherbereichs (Domain), in den das B&R-Modul bertragen
    wird. Dieser Name kann zum Beispiel mit der Funktion @241[PBgetOVI] ermittelt
    werden.














                                        @430[ PBdlN ]                      @001[ šbersicht ]
.440
    PROFIBUS-Library - Event-Dienste

    Diese Funktionsgruppe enth„lt Event-Management-Dienste:

    @441[PBevnotI] Event-Notification per Index
    @450[PBackevI] Acknowledge-Event-Notification per Index
    @460[PBaltevI] Alter-Event-Condition-Monitoring per Index














                                                                     @001[ šbersicht ]
.441
    PBevnotI - Event-Notification per Index

    @442[PBevnotI](enable,kr,index,ev_nr,adr(data),len,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]) der
                                  Zielstation.
    ->  @445[index     ]: WORD          PROFIBUS-Index des Event-Objekts, das aus-
                                  gesendet wird.
    ->  ev_nr     : BYTE          Event Number
    ->  data      : ALLE          Eventinformation die ausgesendet wird.
    ->  len       : WORD          L„nge der Eventinformation in Byte.
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).




                                     @442[ Fortsetzung ]                   @001[ šbersicht ]
.442
    PBevnotI - Event-Notification per Index (Fortsetzung)

    Mit dieser Funktion kann ein Event-Notification-Dienst (per PROFIBUS-Index)
    ber die logische Verbindungsnummer "kr" abgesetzt werden. Die zu sendenden
    Daten mssen im Datenpuffer "data" abgelegt werden. Der Parameter "len" gibt
    die L„nge der Daten an.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.











                                    @440[ Event-Dienste ]                  @001[ šbersicht ]
.445
    PBevnotI - Event-Notification per Index (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index des Event-Objekts. Dieser Index kann ber die Funktion
    @250[PBgetOVN] ermittelt werden.















                                      @441[ PBevnotI ]                     @001[ šbersicht ]
.450
    PBackevI - Acknowledge-Event-Notification per Index

    @450[PBackevI](enable,kr,index,ev_nr,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @455[index     ]: WORD          PROFIBUS-Index des Event-Objekts.
    ->  ev_nr     : BYTE          Event Number
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit dieser Funktion wird ein Event-Notification-Dienst per PROFIBUS-Index
    quittiert.

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.

                                    @440[ Event-Dienste ]                  @001[ šbersicht ]
.455
    PBackevI - Acknowledge-Event-Notification per Index (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index des Event-Objekts. Dieser Index kann ber die Funktion
    @250[PBgetOVN] ermittelt werden.















                                      @450[ PBackevI ]                     @001[ šbersicht ]
.460
    PBaltevI - Alter-Event-Condition-Monitoring per Index

    @461[PBaltevI](enable,kr,index,ev_en,ready,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  @465[index     ]: WORD          PROFIBUS-Index des Event-Objekts.
    ->  ev_en     : BYTE          Event-Freigabe:
                                  $FF ... Event freigeben (enable)
                                  $00 ... Event sperren (disable)
    <-  ready     : BIT           Dienst ist fertig.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit dieser Funktion wird ein Alter-Event-Condition-Monitoring-Dienst (Dienst
    zum Freigeben/Sperren eines Events) per PROFIBUS-Index abgesetzt.



                                     @461[ Fortsetzung ]                   @001[ šbersicht ]
.461
    PBaltevI - Alter-Event-Condition-Monitoring per Index (Fortsetzung)

    Ein Aufruf dieses Dienstes ist erst beendet, wenn der Ausgangsparameter
    "ready" = 1 ist, oder ein Fehler gemeldet wird. Der Dienst ben”tigt dazu
    einen Puffer.
















                                    @440[ Event-Dienste ]                  @001[ šbersicht ]
.465
    PBaltevI - Alter-Event-Condition-Monitoring per Index (Fortsetzung)

    -> Parameter <index     >: WORD

    PROFIBUS-Index des Event-Objekts. Dieser Index kann ber die Funktion
    @250[PBgetOVN] ermittelt werden.















                                      @460[ PBaltevI ]                     @001[ šbersicht ]
.470
    PROFIBUS-Library - Dienste fr C110

    Diese Funktionsgruppe enth„lt Funktionen fr die Kommunikation mit dem C110
    Slave-Controllermodul:

    @490[PBkeyena] Tastendruck-Freigabe
    @500[PBkeyon ] Tastendruck-Abfrage

    Zum Senden einer Sequenz von Daten an den C110 Controller wird der Standard-
    PROFIBUS-Dienst @401[PBirepI] verwendet. Diese Funktion sendet auf der angegebenen
    Verbindung einen Information-Report-Dienst an den C110. Der Dateninhalt
    dieses Aufrufes wird als String an den C110 weitergegeben (siehe Beschrei-
    bung des C110). Dabei wird ber den konstanten Index $FE04 zugegriffen.
    Zum Empfangen der vom C110 Controller gesendeten Tastendrcke wird der
    Standard-PROFIBUS-Dienst @271[PBrec] verwendet. Diese Funktion erlaubt unter
    anderem das Empfangen von Tableau-Meldungen. Trifft von einem C110
    Controller eine Meldung (Taste gedrckt) ein, kann dies ber die Funktion
    PBrec() ausgewertet werden. Mit der Funktion PBkeyena() kann fr jede Taste
    einzeln festgelegt werden, ob sie ber die Funktion PBrec() gemeldet wird
    oder nur im Tastenmerkerabbild abgelegt wird.

                                     @471[ Fortsetzung ]                   @001[ šbersicht ]
.471
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Im Folgenden ist die Kommunikation zwischen einer RPS (SYSTEM 2000) und
    einem C110 Controller beschrieben:

    Der C110 verfgt als Slave-Controller nur ber ein einziges Kommunikations-
    objekt. An dieses Objekt gesendete Strings werden vom C110 als Bildschirm-
    sequenzen (angelehnt an VT100) interpretiert. Der String wird ber den
    festen Index $FE04 angesprochen. Als Dienst ist nur der Information-Report
    m”glich.
    Zum C110 kann nur eine einzige @474[Verbindung] aufgebaut werden, ber die die
    Kommunikation abgewickelt wird. Es kann somit nur von einer einzigen
    Station aus mit dem C110 kommuniziert werden. 

    Die šbertragung von Tastendrcken erfolgt ebenfalls ber Information-
    Report-Dienste. Dabei k”nnen zur Abfrage der Tasten zwei Arten kombiniert
    werden:

    @472[< Tastenabbild >] ... in einem BIT-Feld im DPR des Netzwerk-Controllers
    @473[< Tastencodes  >] ... durch Codesequenzen der gedrckten Tasten

                                     @472[ Fortsetzung ]                   @001[ šbersicht ]
.472
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Tastenabbild:

    Die gesendeten Informationen des C110 werden so ausgewertet, daá ein Ab-
    bild der einzelnen Tasten im DPR des Netzwerk-Controllers angelegt wird.
    Wenn ein Tastendruck erfolgt, wird dieser vom C110 Controller an die RPS
    gemeldet und das korrespondierende Bit im DPR gesetzt. Der Zustand aller
    Tasten eines C110 Controllers kann mit dem FUB @500[PBkeyon] abgefragt werden.

    Die Verbindung zum C110 Controller wird st„ndig berwacht, wird sie unter-
    brochen, werden die Tastenmerker im DPR auf 0 gesetzt.









                                     @473[ Fortsetzung ]                   @001[ šbersicht ]
.473
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Tastencodes:

    Zus„tzlich kann jeder Tastendruck ber die Meldung der Tastencodes ausge-
    wertet werden. Dabei kann fr jede Taste individuell festgelegt werden,
    ob ein Tastendruck an die RPS gemeldet werden soll, oder ob nur das ent-
    sprechende Bit im DPR gesetzt wird. Damit kann man gezielt auf einen
    einzelnen Tastendruck reagieren oder den Zustand der Taste direkt ver-
    knpfen.

    Das Freigeben bzw. Sperren von Tasten erfolgt mit dem FUB @490[PBkeyena].
    Damit wird aber nur festgelegt, welche Tasten gemeldet werden. Die Meldung
    selbst muá mit dem FUB @271[PBrec] abgeholt werden. Dabei ist es wichtig, daá
    die Meldungen der freigegebenen Tasten durch Aufruf des FUBs PBrec() tat-
    s„chlich abgeholt werden. Eine positive Best„tigung des Empfangs erfolgt
    in diesem Fall n„mlich erst mit šbernahme der Daten durch die Anwender-
    software.



                                     @474[ Fortsetzung ]                   @001[ šbersicht ]
.474
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Projektierung der Verbindung:

    Jeder C110 Controller ist mit einer offenen Verbindung projektiert.
    Um von einer RPS aus eine Verbindung mit einem Controller aufnehmen zu
    k”nnen, muá eine korrespondierende Verbindung auf der RPS eingetragen
    werden. Dazu kann entweder das Standardkonfigurationsmodul NW_PLC16.BR
    oder ein mit dem Netzwerk-Konfigurator erstelltes Netzwerkkonfigurations-
    modul verwendet werden.
    Die Werte der Parameter fr diese Verbindung sind entsprechend dem Men
    im Netzwerk-Konfigurator wie folgt einzugeben:

        Name    :       C110_AUTO         Kennung         :       Default
        Typ     :       MMAZ              vb_ci           :       1000
        mul     :       0                 profile_nr      :       0
        ci      :       300




                                     @475[ Fortsetzung ]                   @001[ šbersicht ]
.475
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

                                  Initiator                     Responder

        Attribut                : Definiert                     Offen
        Aufbau                  : Auto                          Auto
        max SCC                 : 0                             0
        max SAC                 : 8                             8
        spdu_high               : 240                           240
        spdu_low                : 240                           240
        ClientService[0]        : $00                           $00
        ClientService[1]        : $00                           $00
        ClientService[2]        : $80                           $80
        pw                      : 0                             0
        group                   : $ff                           $ff
        rsap                    : 128                           128





                                     @476[ Fortsetzung ]                   @001[ šbersicht ]
.476
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Bei der Eingabe der C110 Stationen sind diese beim Eintrag "Hardware" mit
    "PB_BTCTR" anzugeben.
    Da auf dem C110 Controller nur eine Verbindung projektiert ist, kann
    gleichzeitig immer nur eine RPS mit dem C110 Controller Verbindung auf-
    nehmen. Als Destination-SAP (DSAP) muá bei diesen Verbindungen "4" ein-
    gestellt werden, da dieser Kanal am C110 Controller dafr reserviert ist.

    Anmerkung:
    Die derzeit aktuelle Version des Netzwerk-Konfigurators untersttzt die
    Konfiguration der C110 Verbindungen noch nicht vollst„ndig. Aus diesem
    Grund muá das generierte Konfigurationsmodul mit dem mitgelieferten
    Programm "cv_nwkfg" nachbehandelt werden. Dabei muá die Option "-t" an-
    gegeben werden.

    Aufruf: cv_nwkfg   -t   -p.\   cfgmodul.nwm

    Damit wird auf dem Directory ".\br" das bersetzte Konfigurationsmodul
    "cfgmodul.br" abgelegt. Dieses ist auf die Steuerung zu laden.

                                     @477[ Fortsetzung ]                   @001[ šbersicht ]
.477
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Beispiel fr Kommunikation mit dem C110:

    Das Beispielprogramm ermittelt aus dem Netzwerkkonfigurationsmodul die
    Kommunikationsreferenz (logische Verbindungsnummer) der Verbindung zum
    C110 Controller. Die Verbindungen heiát im Standardkonfigurationsmodul
    "C110_x" (mit x entsprechend der Stationsnummer). Fr diese Verbindungen
    muá automatischer Verbindungsaufbau konfiguriert werden. Fr jede Taste
    des Controllers wird das Meldungsbit eingeschaltet. Im Hauptprogramm
    wird das Merkerabbild in einem Feld abgelegt, ankommende Telegramme aus-
    gewertet und eine Ausgabe auf den angeschlossenen Controller durchgefhrt.

    Wird ein Controller abgesteckt, liefert der FUB PBkeyon() dies als Fehler
    4012 (Verbindung ist inaktiv). Wird der Controller wieder angesteckt, nimmt
    er wieder am Datenaustausch teil.





                                     @478[ Fortsetzung ]                   @001[ šbersicht ]
.478
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    INIT-UP der Task:

      ; PROFIBUS-Initialisierung
      initok = 0
      PBinit(1,10,0,0,inierr,memadr)
      ; Es werden 10 Puffer reserviert (damit sind 10 FUB-Aufrufe m”glich)

      ; Bezeichnungen der C110 Verbindungen im Standardkonfigurationsmodul
      ; C110_0, C110_1, ... bis C110_15

      ; KR der Station 0 ermitteln
      if inierr = 0 then
          PBinfoKR(1,"C110_0",0,error,kr)
          if error = 0 then
              initok = 1
                 .
                 .
                 .

                                     @479[ Fortsetzung ]                   @001[ šbersicht ]
.479
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

                 .
                 .
                 .
              ; alle Tasten freigeben (3 Tastenmodule)
              ena_key[0] = $FFFF
              ena_key[1] = $FFFF
              ena_key[2] = $FFFF
              PBkeyena(1,kr,adr(ena_key),sizeof(ena_key),error)
              if error <> 0 then
                  initok = 0
              endif
          else
              initok = 0
          endif
      endif




                                     @480[ Fortsetzung ]                   @001[ šbersicht ]
.480
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

    Zyklischer Teil der Task:

      ; Status der Verbindung abfragen
      if initok = 1 then
          ; Status der Verbindung mit Station 0 abfragen
          PBstatKR(1,kr,error,kr_stat)
          if error = 0 then
              if kr_stat = $FF then
                  conn_on = 1
              else
                  ; Verbindung auf Automatik-Mode umschalten
                  ; (automatischer Verbindungsaufbau)
                  PBautokr(1,kr,1,ready,error)
              endif
          endif
      endif



                                     @481[ Fortsetzung ]                   @001[ šbersicht ]
.481
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

      ; Datenaustausch: Daten ans Display schicken, wenn "send" gesetzt ist
      if conn_on = 1 then
          if send = 1 then
              PBirepI(1,kr,$FE04,0,adr(outdata[0]),len,ready,error)
              if error <> 0 then
                  error_nr = error_nr + 1
              endif
              if ready <> 0 then
                  send = 0
              endif
          endif
      endif







                                     @482[ Fortsetzung ]                   @001[ šbersicht ]
.482
    PROFIBUS-Library - Dienste fr C110 (Fortsetzung)

      ; Status aller Tasten abfragen
      if conn_on = 1 then
          PBkeyon(1,kr,adr(keys),sizeof(keys),error)      ; Tastenabbild
      endif

      ; Tastencodes empfangen
      PBrec(1,adr(par_struct),ready,error,dataptr)        ; Tastencodes
      if ready = 1 then
          incount = incount + 1
          if par_struct.kr = kr then
              loop i = 0 to par_struct.len - 1 do
                  datacopy access (dataptr + i)
                  indata[i] = datacopy
              endloop
          endif
      endif



                                  @470[ Dienste fr C110 ]                 @001[ šbersicht ]
.490
    PBkeyena - Tastendruck-Freigabe

    @491[PBkeyena](enable,kr,adr(ena_ptr),len,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    ->  ena_ptr   : BYTE (FELD)   Jedes Bit dieses BYTE-Feldes ist einer Taste
                                  zugeordnet und gibt an, ob diese Taste durch
                                  den Funktionsblock @271[PBrec] weitergemeldet werden
                                  soll:
                                  Bit = 1 ... Tastendruck an die RPS durch-
                                              reichen.
                                  Bit = 0 ... Tastenzustand nur im Merkerabbild
                                              speichern.




                                     @491[ Fortsetzung ]                   @001[ šbersicht ]
.491
    PBkeyena - Tastendruck-Freigabe (Fortsetzung)

    ->  len       : WORD          L„nge des BYTE-Feldes ena_ptr.
                                  Die L„nge len sollte immer eine gerade Zahl
                                  sein, da vom C110 Controller fr jeden Tasten-
                                  block zwei Byte reserviert werden.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).

    Mit dieser Funktion kann fr einen C110 Controller festgelegt werden, welche
    Tastendrcke an die RPS weitergemeldet werden.
    Wird am C110 Controller eine Taste gedrckt, wird diese im Tastenmerker-
    abbild (im DPR) des Netzwerk-Controllers als Bit = 1 abgelegt. Wird diese
    Taste wieder losgelassen, wird das Tastenmerkerbit = 0 gesetzt. Mit der
    Funktion PBkeyena() kann man fr jede Taste festlegen, ob zus„tzlich zum
    Merkerabbild im DPR eine Meldung an die RPS weitergeleitet werden soll. Dazu
    ist jeder Taste ein Bit im BYTE-Feld "ena_ptr" zugeordnet. Wenn eine Taste
    gedrckt wird und das entsprechende Bit im BYTE-Feld "ena_ptr" 1 ist, wird
    der Tastendruck ber die Funktion @271[PBrec] an die Applikation gemeldet. Sonst
    wird der Tastenzustand nur im Merkerabbild gespeichert.


                                     @492[ Fortsetzung ]                   @001[ šbersicht ]
.492
    PBkeyena - Tastendruck-Freigabe (Fortsetzung)

    Die Funktion PBkeyena() greift nur auf Speicherbereiche im DPR des Netzwerk-
    Controllers zu und ben”tigt keinen Puffer.

















                                  @470[ Dienste fr C110 ]                 @001[ šbersicht ]
.500
    PBkeyon - Tastendruck-Abfrage

    @501[PBkeyon](enable,kr,adr(key_ptr),len,error_nr)

    Parameter-Datentypen :
    ->  enable    : BIT           Der Funktionsblock wird nur ausgefhrt, wenn
                                  enable = 1 ist.
    ->  kr        : WORD          Kommunikationsreferenz (logische Verbindungs-
                                  nummer, siehe Funktionsblock @031[PBinfoKR]).
    <-> key_ptr   : BYTE (FELD)   Jedes Bit dieses BYTE-Feldes ist einer Taste
                                  zugeordnet und gibt an, ob diese Taste ge-
                                  drckt ist oder nicht:
                                  Bit = 1 ... Taste ist gedrckt.
                                  Bit = 0 ... Taste ist nicht gedrckt.
    ->  len       : WORD          L„nge des BYTE-Feldes key_ptr.
                                  Die L„nge len sollte immer eine gerade Zahl
                                  sein, da vom C110 Controller fr jeden Tasten-
                                  block zwei Byte reserviert werden.
    <-  @800[error_nr  ]: WORD          Fehlernummer (0 = kein Fehler).


                                     @501[ Fortsetzung ]                   @001[ šbersicht ]
.501
    PBkeyon - Tastendruck-Abfrage (Fortsetzung)

    Mit dieser Funktion kann abgefragt werden, welche Tasten eines C110
    Controllers gedrckt sind. Die Tastenzust„nde werden in einem BYTE-Feld
    abgespeichert, in dem jedes Bit einer Taste zugeordnet ist.
    Wird am C110 Controller eine Taste gedrckt, wird das entsprechende Bit im
    Tastenmerkerabbild gesetzt. Wird diese Taste wieder losgelassen, wird das
    Tastenmerkerbit wieder rckgesetzt. Ist die Verbindung zum C110 unter-
    brochen, wird am Ausgang "error_nr" eine entsprechende Fehlernummer ausge-
    geben und die Tastenmerker auf 0 gesetzt.

    Die Funktion PBkeyon() greift nur auf Speicherbereiche im DPR des Netzwerk-
    Controllers zu und ben”tigt keinen Puffer.








                                  @470[ Dienste fr C110 ]                 @001[ šbersicht ]
.540
    PROFIBUS-Library - Subindex bei Read-Diensten

    Der Subindex wird beim Zugriff auf Elemente von Feldern (Arrays) oder
    Strukturen ben”tigt:

    - Variablen einfachen Datentyps:
      Bei Variablen einfachen Datentyps (BIT, INT8, INT16, INT32, BYTE, WORD,
      LONG und FLOAT) muá fr den Parameter "subindex" immer der Wert 0 ange-
      geben werden!

    - Feldelemente:
      Um auf ein einzelnes Feldelement zugreifen zu k”nnen, muá fr den
      Parameter "subindex" die Nummer dieses Feldelements angegeben werden. Wenn
      Sie z.B. das vierte Element (Element mit Index 3) einer Feldvariable lesen
      m”chten, mssen Sie fr den Parameter "subindex" den Wert 4 bergeben.
      Um das gesamte Feld zu lesen, muá der Parameter "subindex" 0 sein!





                                     @541[ Fortsetzung ]                   @001[ šbersicht ]
.541
    PROFIBUS-Library - Subindex bei Read-Diensten (Fortsetzung)

    - Strukturelemente:
      Elemente einer Strukturvariable k”nnen nicht ber ihren Namen identi-
      fiziert werden. Um auf ein einzelnes Element einer Struktur zugreifen
      zu k”nnen, muá fr den Parameter "subindex" die Nummer des Elements in der
      Struktur (beginnend mit 1) angegeben werden. Wenn Sie z.B. eine Struktur-
      variable mit den Elementen X, Y und Z haben, wird das Element Z mit
      Subindex 3 angesprochen.
      Um die ganze Struktur zu lesen, muá der Parameter "subindex" 0 sein!











                                                                     @001[ šbersicht ]
.542
    PROFIBUS-Library - Subindex bei Write-Diensten

    Der Subindex wird beim Zugriff auf Elemente von Feldern (Arrays) oder
    Strukturen ben”tigt:

    - Variablen einfachen Datentyps:
      Bei Variablen einfachen Datentyps (BIT, INT8, INT16, INT32, BYTE, WORD,
      LONG und FLOAT) muá fr den Parameter "subindex" immer der Wert 0 ange-
      geben werden!

    - Feldelemente:
      Um auf ein einzelnes Feldelement zugreifen zu k”nnen, muá fr den
      Parameter "subindex" die Nummer dieses Feldelements angegeben werden.
      Wenn Sie z.B. das vierte Element (Element mit Index 3) einer Feldvariable
      beschreiben m”chten, mssen Sie fr den Parameter "subindex" den Wert 4
      bergeben. Um das gesamte Feld zu beschreiben, muá der Parameter
      "subindex" 0 sein!




                                     @543[ Fortsetzung ]                   @001[ šbersicht ]
.543
    PROFIBUS-Library - Subindex bei Write-Diensten (Fortsetzung)

    - Strukturelemente:
      Elemente einer Strukturvariable k”nnen nicht ber ihren Namen identi-
      fiziert werden. Um auf ein einzelnes Element einer Struktur zugreifen
      zu k”nnen, muá fr den Parameter "subindex" die Nummer des Elements in der
      Struktur (beginnend mit 1) angegeben werden. Wenn Sie z.B. eine Struktur-
      variable mit den Elementen X, Y und Z haben, wird das Element Z mit
      Subindex 3 angesprochen.
      Um die ganze Struktur zu beschreiben, muá der Parameter "subindex" 0 sein!











                                                                     @001[ šbersicht ]
.550
    ANHANG : LIBRARY-Informationen


    @551[< Allgemeines           >]     Voraussetzungen etc.
    @560[< Hinweise              >]     Anwendungen der PROFIBUS-Library
    @600[< Server-Funktionen     >]     Server-Funktionen und Programmierung der RPS
    @610[< Netzwerkkonfiguration >]     Netzwerkkonfigurationsmodul
    @620[< PROFIBUS-FDL          >]     Senden/Empfangen von Layer2-Diensten
    @650[< Objektverzeichnis     >]     Objektverzeichnis und Objektbeschreibungen
    @700[< PROFIBUS-Indizes      >]     PROFIBUS-Indizes im SYSTEM 2000
    @750[< Syntax                >]     Syntax fr die Erkl„rung der Funktionen
    @800[< Fehlernummern         >]     Zusammenfassung aller Fehlernummern
    @900[< History               >]     Neue Funktionalit„ten und Versions„nderungen








                                                                     @001[ šbersicht ]
.551
    PROFIBUS-Library : Allgemeines

    Mit den Funktionen der PROFIBUS-Library k”nnen Daten von einer PROFIBUS-
    Station gelesen bzw. Daten an eine PROFIBUS-Station gesendet werden.
    Detaillierte Informationen zum Thema "PROFIBUS-Netzwerk" finden Sie im
    "PROFIBUS Anwenderhandbuch".

    Anmerkungen:
    - Bevor Sie die Funktionen der PROFIBUS-Library in Ihrem Projekt verwenden
      k”nnen, mssen Sie die Library in die entsprechende Projekt-Datenbank
      importieren.

    - Da die PROFIBUS-Library AVT-Funktionen enth„lt, k”nnen die Funktionen
      dieser Library nur verwendet werden, wenn das Library-Runtime-Modul
      (B&R-Modul PB_LIB.BR) auf der CPU (Anwender-ROM) vorhanden ist!

    - Alle Funktionen der PROFIBUS-Library liefern im Fehlerfall als Ergebnis
      eine @800[Fehlernummer].



                                     @552[ Fortsetzung ]                   @001[ šbersicht ]
.552
    PROFIBUS-Library : Allgemeines (Fortsetzung)

    Fast alle Funktionen der PROFIBUS-Library verfgen ber folgende Ein- und
    Ausgangsparameter:

    Eingangsparameter "enable":
    Dieser Eingang gibt den Funktionsblock (FUB) frei. Der Eingang "enable"
    muá w„hrend der gesamten Zeit der Dienstabwicklung aktiv bleiben! D.h.
    der Eingang "enable" muá solange auf 1 gesetzt bleiben, bis der Dienst
    abgeschlossen ist (Ausgang "ready" = 1 oder Ausgang "error_nr" <> 0).

    Ausgangsparameter "ready":
    Dienst ist fertig abgewickelt. Dieser Ausgang geht nur dann auf 1, wenn
    der Dienst ohne Fehler abgeschlossen werden konnte. Im n„chsten Zyklus
    wird der Ausgang "ready" wieder rckgesetzt.

    Ausgangsparameter "error_nr":
    Wurde der Dienst nicht beantwortet oder trat ein anderer Fehler auf, wird
    am Ausgang "error_nr" eine entsprechende Fehlernummer ausgegeben. In diesem
    Fall wird der Ausgang "ready" nicht gesetzt.

                                     @553[ Fortsetzung ]                   @001[ šbersicht ]
.553
    PROFIBUS-Library : Allgemeines (Fortsetzung)

    Fehlt bei einem Funktionsblock der Ausgang "ready", so handelt es sich um
    einen Funktionsblock, der die Antwort sofort nach seinem Aufruf bereit-
    stellt (diese Funktionsbl”cke allokieren keine Struktur im DPR des
    Netzwerk-Controllers). Alle anderen Funktionsbl”cke ben”tigen mehrere
    Task-Zyklen, bis die Antwort bereitgestellt wird.

    Die folgenden Grafiken zeigen den zeitlichen Ablauf eines FUB-Aufrufes:

    Fehlerfreier Fall:

    Zyklus:       1      2      3      4      5      6      7      8
                                                            
                  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    "enable"   ÄÄÄÙ                              ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                               ÚÄÄÄÄ¿
    "ready"    ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ    ÀÄÄÄÄÄÄÄÄÄÄÄ

    "error_nr" ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                                     @554[ Fortsetzung ]                   @001[ šbersicht ]
.554
    PROFIBUS-Library : Allgemeines (Fortsetzung)

    Fehlerfall:

    Zyklus:       1      2      3      4      5      6      7      8
                                                            
                  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    "enable"   ÄÄÄÙ                              ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    "ready"    ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                               ÚÄÄÄÄ¿
    "error_nr" ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ    ÀÄÄÄÄÄÄÄÄÄÄÄ









                                     @555[ Fortsetzung ]                   @001[ šbersicht ]
.555
    PROFIBUS-Library : Allgemeines (Fortsetzung)

    Anmerkungen:
    Die Funktionsbl”cke der PROFIBUS-Library codieren eine Dienstanforderung
    (Request), schicken den Dienst ab und warten auf die Antwort (Response)
    der Gegenstelle. W„hrend die Antwort noch ausst„ndig ist, k”nnen ber
    diesen Funktionsblock keine weiteren Dienste gesendet werden. Nach
    Beantwortung des Dienstes meldet der Ausgang "ready", daá der Dienst
    beantwortet wurde ("ready" = 1) und gegebenenfalls Daten zur Verfgung
    stehen. Im n„chsten Zyklus wird der Ausgang "ready" wieder rckgesetzt.
    Wurde der Dienst nicht beantwortet oder trat ein anderer Fehler auf,
    meldet der Funktionsblock einen entsprechenden Fehler. Erst wenn der
    Dienst fertig abgearbeitet wurde ("ready" = 1) oder wenn ein Fehler ge-
    meldet wurde, ist der Funktionsblock wieder bereit fr einen neuen Dienst.
    Einige Funktionsbl”cke senden keine Nachricht ber den Bus, sondern werden
    nur fr den Austausch von Statusinformationen aufgerufen. Diese Funktions-
    bl”cke mssen nur einmal aufgerufen werden und liefern die Antwort sofort
    (Funktionsbl”cke ohne "ready"-Ausgang).



                                     @556[ Fortsetzung ]                   @001[ šbersicht ]
.556
    PROFIBUS-Library : Allgemeines (Fortsetzung)

    Werden von einem Funktionsblock Nachrichten gesendet, ben”tigt er fr diese
    einen Zwischenspeicher, bis der Dienst vollst„ndig beantwortet wurde. Diese
    Zwischenspeicher (Puffer) werden schon bei der Initialisierung durch die
    Funktion PBinit() angelegt. Dabei ist die Anzahl der notwendigen Puffer
    als Parameter anzugeben. Die Tatsache, ob ein FUB einen Puffer ben”tigt
    oder nicht, wird fr jeden FUB in der Funktionsbeschreibung angegeben.













                                       @550[ ANHANG ]                      @001[ šbersicht ]
.560
    PROFIBUS-Library : Hinweise

    Im folgenden Abschnitt erfahren Sie, worauf Sie beim Einsatz der PROFIBUS-
    Funktionen achten mssen. Auáerdem sind in diesem Abschnitt einige typische
    Anwendungen der PROFIBUS-Library beschrieben.

    Variablen lesen/schreiben:
    Unter Angabe eines Index (Funktion PBreadI() und PBwriteI()) oder Namens
    (Funktion PBreadN() und PBwriteN()) kann eine Variable von der Zielstation
    gelesen oder beschrieben werden. Dabei kann auch auf Felder, Elemente von
    Feldern bzw. Strukturen zugegriffen werden. Allerdings darf die L„nge der
    Daten die maximal m”gliche L„nge eines PROFIBUS-Frames (ca. 230 Bytes)
    nicht berschreiten!

    Variablenbereiche lesen/schreiben:
    Auf Felder bzw. Strukturen, die die Gr”áe eines PROFIBUS-Frames ber-
    schreiten, kann mit den normalen Read/Write-Diensten nicht zugegriffen
    werden. Um dennoch einen einfachen Zugriff auf diese Felder bzw. Strukturen
    zu erm”glichen, wurden die Funktionen PBreadX() und PBwriteX() eingefhrt.


                                     @561[ Fortsetzung ]                   @001[ šbersicht ]
.561
    PROFIBUS-Library : Hinweise (Fortsetzung)

    PROFIBUS-Variablenlisten:
    Mit den Funktionen PBdefVLI() und PBdefVLN() k”nnen Variablen zu Listen
    zusammengefaát werden. Diese Variablenlisten k”nnen mit den normalen
    Read/Write-Diensten gelesen/beschrieben werden (Einschr„nkung ist wiederum
    die PROFIBUS-Frame-L„nge).

    B&R-Variablenlisten:
    Mit den Funktionen PBrdDVL() und PBwrDVL() kann (auch ohne vorher eine
    Variablenliste definieren zu mssen) mit einem Dienst auf mehrere Variablen
    zugegriffen werden!
    Die Funktionen PBrdDVL() und PBwrDVL() sind B&R-spezifisch, d.h. sie k”nnen
    nur fr den Datenaustausch zwischen zwei B&R-Ger„ten verwendet werden!







                                     @562[ Fortsetzung ]                   @001[ šbersicht ]
.562
    PROFIBUS-Library : Hinweise (Fortsetzung)

    Speicherbereich lesen/schreiben:
    šber die Funktion PBinit() kann im DPR des Netzwerk-Controllers ein
    Speicherblock reserviert werden, der dann ber das Netzwerk gelesen bzw.
    beschrieben werden kann (Einschr„nkungen siehe Beschreibung der Funktionen
    PBrdDPR() bzw. PBwrDPR()).
    Auf diesen Speicherbereich kann von einer Task aus mit dem access Operator
    eine Variable (Struktur, Feld) gelegt werden.
    Vorsicht: Es wird keine Datenkonsistenz garantiert (der Bereich ist nicht
    nullspannungssicher).
    Der Vorteil dieser Zugriffsart besteht darin, daá die Beantwortung der
    Read/Write-Dienste direkt vom Netzwerk-Controller durchgefhrt wird, und
    damit keine Systemzeit (CPU-Zeit) auf der Zielstation ben”tigt wird.
    Auáerdem erfolgt die Beantwortung des Dienstes schneller und die L„nge der
    Daten ist nicht auf die maximale L„nge eines PROFIBUS-Frames begrenzt.





                                     @563[ Fortsetzung ]                   @001[ šbersicht ]
.563
    PROFIBUS-Library : Hinweise (Fortsetzung)

    Broadcast/Multicast-Datenverkehr:
    šber die Funktion PBirepI() kann eine Meldung im Broad- bzw. Multicast
    versendet werden. Die dabei angegebene Verbindung muá als Broad- bzw.
    Multicastverbindung projektiert sein! Mit der Funktion PBrec() k”nnen
    solche Meldungen empfangen und ausgewertet werden.
    šber die Funktion PBirepI() kann auch auf einer Standardverbindung eine
    Meldung abgesetzt werden (Meldung geht nur zu einer Steuerung). Auch diese
    Meldung kann mit der Funktion PBrec() empfangen und ausgewertet werden.

    Senden von Layer2-Diensten und Empfangen von Layer2-/Layer7-Diensten:
    Mit dem Funktionsblock PBsend() ist das Senden von Layer2-Diensten m”glich.
    Mit dem Funktionsblock PBrec() k”nnen PROFIBUS-Dienste (sowohl Layer7-
    Dienste als auch Layer2-Dienste) empfangen werden.






                                     @564[ Fortsetzung ]                   @001[ šbersicht ]
.564
    PROFIBUS-Library : Hinweise (Fortsetzung)

    Synchronisierung von RPSen ber das Netzwerk:
    šber den Dienst PBirepI() kann eine Meldung von einer RPS an alle anderen
    gesendet werden.
    Alle Empfangsstationen k”nnen ber den Empfang dieser Meldung synchroni-
    siert werden. Dazu muá die Verbindung, auf der die Meldung empfangen wird,
    beim Aufruf des Funktionsblocks PBsyncKR() angegeben werden. Dieser
    Funktionsblock liefert einen Z„hler, der bei jedem Empfang eines Telegramms
    auf der angegebenen Verbindung erh”ht wird. Mit der Aufrufrate des
    Funktionsblocks PBsyncKR() kann die Genauigkeit der Zeitsynchronisation
    selbst bestimmt werden.
    Die Erh”hung des Z„hlers erfolgt auf allen Station (gleichzeitig) unmittel-
    bar nach Empfang des letzten Zeichens des Telegramms.
    šber den Funktionsblock PBsyncKR() kann auch die sendende Station synchro-
    nisiert werden.





                                     @565[ Fortsetzung ]                   @001[ šbersicht ]
.565
    PROFIBUS-Library : Hinweise (Fortsetzung)

    Verbindungsmanagement:
    Bei der Netzwerkkonfiguration kann festgelegt werden, daá eine Verbindung
    vom Netzwerk-Controller selbst„ndig aufgebaut wird. Damit braucht sich der
    Anwender nicht um den Verbindungsaufbau zu kmmern. Broad- bzw. Multicast-
    verbindungen sind immer aufgebaut!
    Verbindungen, die nicht mit automatischem Verbindungsaufbau konfiguriert
    sind, k”nnen ber die Funktion PBautoKR() auf Automatik geschaltet werden.
    šber die Funktion PBstatKR() kann der aktuelle Zustand der Verbindung ab-
    gefragt werden (Verbindung aufgebaut/nicht aufgebaut).
    Mit der Funktion PBinfoKR() kann zu einem Verbindungsnamen die zugeh”rige
    Kommunikationsreferenz (logische Verbindungsnummer) bestimmt werden.
    Auáerdem k”nnen mit dieser Funktion einige Zusatzinformationen zu der
    Verbindung abgerufen werden.






                                       @550[ ANHANG ]                      @001[ šbersicht ]
.600
    PROFIBUS-Library : Server-Funktionen und Programmierung der RPS

    Damit an eine RPS Dienstaufforderungen gesandt werden k”nnen, sind auf
    der RPS Server-Funktionen implementiert. Ein Request (Dienstaufforderung)
    wird vom PROFIBUS Netzwerkmodul empfangen, an die CPU weitergeleitet und
    dort von einer Server-Task bearbeitet und beantwortet. Die Server-Routinen
    sind dabei Bestandteile des Betriebssystems und brauchen nicht vom Anwender
    implementiert werden.
    šber diese Routinen ist nicht nur der Zugriff auf Variablen m”glich,
    es k”nnen auch alle notwendigen Dienste zur Programmierung der RPS in
    Anspruch genommen werden.










                                       @550[ ANHANG ]                      @001[ šbersicht ]
.610
    PROFIBUS-Library : Netzwerkkonfigurationsmodul

    Fr jeden einzelnen Teilnehmer im PROFIBUS-Netzwerk wird also ein so-
    genanntes Netzwerkkonfigurationsmodul erstellt, in dem alle fr die
    entsprechende Station erforderlichen Konfigurationsdaten enthalten sind.

    Zur Netzwerkkonfiguration k”nnen sowohl Standardkonfigurationsmodule als
    auch spezielle, mit dem Netzwerk-Konfigurator erstellte, Konfigurationen
    verwendet werden. Detaillierte Informationen zu diesem Thema finden Sie
    im "PROFIBUS Anwenderhandbuch".

    Bei den einzelnen Funktionsbl”cken reicht die Angabe der Kommunikations-
    referenz (logische Verbindungsnummer), um eine Zielstation eindeutig zu
    adressieren. Die logische Verbindungsnummer kann mit dem Funktionsblock
    PBinfoKR() bestimmt werden.






    @611[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.611
    PROFIBUS-Library : Netzwerkkonfigurationsmodul (Fortsetzung)

    Bei der Netzwerkkonfiguration kann angegeben werden, welche Verbindungen
    automatisch aufgebaut werden sollen (Parameter vb_info der KBL, siehe
    "PROFIBUS Anwenderhandbuch"). Weiters kann eine Verbindung, fr die kein
    automatischer Verbindungsaufbau konfiguriert wird, durch den Funktions-
    block PBautoKR() auf automatischen Verbindungsaufbau (Automatik-Mode)
    geschaltet werden. Dies ist beispielsweise bei den Standardkonfigurations-
    modulen notwendig.
    Wird eine Verbindung mit automatischem Verbindungsaufbau durch eine
    St”rung am Netz (z.B. Ziehen des Bussteckers) abgebaut, versucht der
    Netzwerk-Controller selbst„ndig (in projektierbaren Zeitintervallen) die
    Verbindung wieder aufzubauen. D.h. der Anwender muá sich nicht um den
    Auf-/Abbau von Verbindungen kmmern.







                                       @550[ ANHANG ]                      @001[ šbersicht ]
.620
    PROFIBUS-Library : PROFIBUS-FDL

    šber PROFIBUS-FDL ist es m”glich, auf Layer2-Basis mit anderen PROFIBUS-
    Stationen zu kommunizieren. So basieren z.B. alle PROFIBUS-Produkte von
    Siemens (SINEC-L2) auf dem genormten PROFIBUS-Layer2 und unterscheiden
    sich nur hinsichtlich der Auspr„gung des Layer7:

    - FMS ................. gem„á PROFIBUS-Norm
    - L2-DP ............... gem„á PROFIBUS-Norm
    - L2-TF ............... Siemens-spezifisch
    - L2-Schnittstellen ... Siemens-spezifisch
      Davon gibt es gem„á SINEC-L2 Systembeschreibung unterschiedliche Aus-
      pr„gungen, die als "Datenbertragungsarten" bezeichnet werden:
       - Standardverbindung
       - AGAG-Verbindung
       - Zyklische Peripherie (ZP)
       - Layer2-Zugang-FDL




                                     @621[ Fortsetzung ]                   @001[ šbersicht ]
.621
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Alle bei B&R eingesetzten PROFIBUS-Produkte basieren auf dem PROFIBUS-
    Layer2 + FMS. Zur Kopplung mit SINEC-L2-FDL ist der Layer2 ber Funktions-
    bl”cke bedienbar. Weiters kann gleichzeitig ber FMS kommuniziert werden.
    Dabei tritt das Problem auf, daá bei empfangenen Telegrammen eine direkte
    Zuordnung zu einem "Abnehmer" gefunden werden muá. Dieser "Abnehmer" ist
    entweder das FMS oder der Layer2-Empfangs-FUB. Die Zuordnung wird dabei
    nach folgendem Grundsatz durchgefhrt:

    - Bevor man Layer2-Dienste aufrufen kann, muá ein @625[Layer2-SAP] (SAP = Service
      Access Point) dafr konfiguriert werden.
    - Ein @625[Layer2-SAP], der fr das Empfangen von Diensten konfiguriert ist,
      leitet alle Empfangstelegramme auf den Layer2-Empfangs-FUB.
    - Vorsicht: Beim gemeinsamen Betrieb von FMS und FDL ist vom Anwender dafr
      Sorge zu tragen, daá keine Layer2-Dienste ber SAPs, die vom Layer7 ver-
      wendet werden, abgewickelt werden.




                                     @622[ Fortsetzung ]                   @001[ šbersicht ]
.622
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Folgende Einschr„nkungen sind zu beachten:

    - Maximale Baudrate von 500 KBit/s (durch bestehende Hardware gegeben).
    - Die @627[Layer2-Timingparameter] mssen richtig eingestellt werden.
    - Voraussetzung fr den Einsatz der Layer2-FUBs ist die PROFIBUS-Firmware
      V2.00 (die PROFIBUS-Firmware muá auf dem Modul NW100 bzw. NW150 vor-
      handen sein).












                                     @623[ Fortsetzung ]                   @001[ šbersicht ]
.623
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Zum Betrieb der FDL-Funktionen ist (wie auch fr FMS) die Library PB_LIB.BR
    zu verwenden. Diese erlaubt ab Version 2.00 die Verwendung von FMS- und
    FDL-Diensten.
    šber den FUB PBsend() ist das Senden von Layer2-Diensten m”glich. Der FUB
    PBrec() erm”glicht das Empfangen von Layer7- und Layer2-Diensten.
    Zum Betrieb der Layer2-Funktionsbl”cke ist (wie auch fr den FMS-Betrieb)
    eine Initialisierung durch den FUB PBinit() notwendig. 
    Der FUB PBsend() ist mit einer Versionsprfung ausgestattet. Mit dieser
    Versionsprfung wird kontrolliert, ob die vorliegende Netzwerk-Karte mit
    einer Firmware-Version gr”áer oder gleich V2.00 ausgestattet ist. Ist dies
    nicht der Fall, meldet der FUB sofort einen Fehler. 
    Der Layer2 unterscheidet drei Dienstprimitiven:

    - Request
    - Confirm
    - Indication



                                     @624[ Fortsetzung ]                   @001[ šbersicht ]
.624
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Der ausgesendete Request wird durch die Confirmation best„tigt. Diese kann
    auch direkt Empfangsdaten liefern (SRD-Dienst).
    Zur Vereinfachung wird der Request und die Confirmation durch einen FUB
    (Funktionsblock PBsend()) abgedeckt. Liefert der Funktionsblock das Signal
    "ready", ist die Confirmation bereits eingetroffen. Der Anwender kann damit
    direkt auf die Antwortdaten bzw. den Antwortstatus zugreifen, ohne die
    Confirmation extra abholen und dann selbst dem Request zuordnen zu mssen.












                                     @625[ Fortsetzung ]                   @001[ šbersicht ]
.625
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Layer2-SAPs:

    Im Folgenden soll die Bedeutung und Verwendung von Layer2-SAPs n„her be-
    schrieben werden. Einen Layer2-SAP kann man als logischen Kanal auffassen,
    ber den eine FMS-Verbindung gefhrt wird, bzw. ein FDL-Dienst abgewickelt
    wird.

    Es gibt 64 Layer2-SAPs von denen einige reserviert sind:
       SAP = 1 ........... fr Managementzwecke 
       SAP = 63 .......... Global SAP fr Broadcasts

    Fr PROFIBUS-DP sind folgende SAPs reserviert:
       SAP = 54 bis 62
       SAP = NIL ......... Default-SAP





                                     @626[ Fortsetzung ]                   @001[ šbersicht ]
.626
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Alle anderen SAPs k”nnen frei verwendet werden. Folgende Vorgangsweise ist
    jedoch zu empfehlen:

    - In der Regel werden die SAPs 0, 2 bis 33 fr FMS-Verbindungen verwendet.
      Diese SAPs sollten nicht fr FDL-Dienste konfiguriert werden (pro FMS-
      Verbindung wird ein SAP ben”tigt).
    - Ist die Verwendung dieser SAPs fr FDL-Dienste nicht zu vermeiden, muá
      sichergestellt sein, daá im Netzwerkkonfigurationsmodul fr diese SAPs
      keine FMS-Verbindungen konfiguriert sind!
    - Bei Verwendung der Standardnetzwerkkonfigurationsmodule "NW_PLC32.BR"
      oder "NW_PLC16.BR" sind die SAPs 0, 2 bis 33, 62 und 63 durch FMS-
      Verbindungen belegt!







                                     @627[ Fortsetzung ]                   @001[ šbersicht ]
.627
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Layer2-Busparameter:

    Bei PROFIBUS-Kopplungen mit Fremdstationen ist die richtige Einstellung
    der Layer2-Busparameter zu beachten! Die folgenden Betrachtungen gelten
    fr eine Baudrate von 500 KBit.
    Die z.B. bei neuen Siemens-Anschaltungen eingesetzten ASICs erlauben ein
    sehr schnelles Bustiming. Damit mit diesen Anschaltungen kommuniziert
    werden kann, mssen die Layer2-Busparameter auf beiden Seiten richtig ein-
    gestellt werden. Folgende Zeiten sind dafr von grundlegender Bedeutung:

       TSET
       min_TSDR
       max_TSDR
       Tsl





                                     @628[ Fortsetzung ]                   @001[ šbersicht ]
.628
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Bei einer Kopplung Fremdstation/B&R-Station unterscheidet man zwei F„lle:
    1. B&R mit Standardkonfigurationsmodul:
        - Die Layer2-Busparameter sind durch das Konfigurationsmodul vorgegeben
        - Auf der Fremdstation sind folgende Werte einzustellen:
          TSET     = 255
          min_TSDR = 255
          max_TSDR = 1000
          Tsl      = 3000
    2. B&R frei konfiguriert (die Layer2-Busparameter sind frei einstellbar):
        - Folgende Grenzwerte gelten fr die B&R-Anschaltung:
          TSET     = 150
          min_TSDR = 350
          max_TSDR = 400
          Tsl      = 2000
        - Auf der Fremdstation ist folgendes einzustellen:
          TSET     = 150
          min_TSDR = 255 (meist gr”átm”glicher Wert!)
          max_TSDR = 400
          Tsl      = 2000
                                     @629[ Fortsetzung ]                   @001[ šbersicht ]
.629
    PROFIBUS-Library : PROFIBUS-FDL (Fortsetzung)

    Anmerkungen:
    Der Parameter TSET wird bei B&R-Anschaltungen nicht ausgewertet. Die
    Timing-Einstellung erfolgt ber min_TSDR und max_TSDR.
    Alle Zeiten mssen (soweit m”glich) auf beiden Stationen gleich eingestellt
    werden!
    Die Einstellung von Tqui ist gegenber den anderen Zeiten in der Regel ver-
    nachl„ssigbar (meist Tqui = 0).
    Die Einstellung von TTR wirkt sich nicht fr das korrekte Zusammenspiel des
    Layer2 der einzelnen Station aus, sondern muá "groá genug" gew„hlt werden.
    Pro Token-Umlauf muá ausreichend Zeit fr die Abwicklung von Layer2-Diensten
    bleiben.








                                       @550[ ANHANG ]                      @001[ šbersicht ]
.650
    PROFIBUS-Library : Objektverzeichnis

    Damit die Teilnehmer in einem PROFIBUS-Netzwerk kommunizieren k”nnen, muá
    jeder Teilnehmer allen anderen Teilnehmern eine Beschreibung seiner Objekte
    ("Objektbeschreibungen" genannt) zur Verfgung stellen.
    Alle Objektbeschreibungen eines Teilnehmers sind im Objektverzeichnis
    zusammengefaát. šber dieses Objektverzeichnis wird der Zugriff auf die
    einzelnen Objekte erm”glicht. Erst durch dieses Objektverzeichnis werden
    allen Busteilnehmern die lokal auf einer Station vorhandenen Objekte,
    deren Bedeutung und Struktur zug„nglich gemacht.
    Detaillierte Informationen zum Thema "Objektverzeichnis" finden Sie im
    "PROFIBUS Anwenderhandbuch".
    Die Objektbeschreibungen eines Teilnehmers k”nnen von anderen Teilnehmern
    mittels des PROFIBUS-Dienstes Get-OV gelesen werden. Dabei kann zwischen
    zwei Formaten fr die Objektbeschreibungen gew„hlt werden:

    @660[Long-Version ] ... Es werden alle Informationen, die von einem Objekt zur
                      Verfgung stehen, bertragen.
    @680[Short-Version] ... Es werden nur die wichtigsten Objekt-Informationen ber-
                      tragen.

                                     @651[ Fortsetzung ]                   @001[ šbersicht ]
.651
    PROFIBUS-Library : Objektverzeichnis (Fortsetzung)

    Auf eine Objektbeschreibung kann nicht ber eine Struktur zugegriffen
    werden, da die einzelnen Elemente nicht auf WORD ausgerichtet sind (WORD-
    oder LONG-Elemente k”nnen bei einer ungeraden Adresse beginnen)! Der
    Zugriff auf eine Objektbeschreibung ist z.B. ber ein BYTE-Feld m”glich.

    Fordert man die Objektbeschreibung vom Index 0 an, so erh„lt man globale
    Informationen ber alle Objekte auf der Gegenstation. Beim Element
    "Namensl„nge" dieser Objektbeschreibung ist besondere Vorsicht geboten.
    Dieses Element gibt die L„nge des symbolischen Namens der Variable auf
    der Gegenstation an. Ist der symbolische Variablenname krzer als unter
    "Namensl„nge" angegeben, muá der symbolische Variablenname mit Leerzeichen
    auf die unter "Namensl„nge" angegeben L„nge aufgefllt werden.







                                       @550[ ANHANG ]                      @001[ šbersicht ]
.660
    PROFIBUS-Library : Long-Version der Objektbeschreibung

    Die einzelnen Objekte einer Station sind in Objektgruppen (Domain, Program-
    Invocation, Event, Datentyp, usw.) zusammengefaát. Die Objektbeschreibung
    ist fr jede Objektgruppe unterschiedlich aufgebaut:

    @663[Domain                       ] Beschreibungen von Speicherbereichen
    @664[Program-Invocation           ] Programmbeschreibungen
    @665[Event                        ] Eventbeschreibungen
    @666[Datentyp                     ] Datentypbeschreibungen
    @667[Datentyp Strukturbeschreibung] Strukturbeschreibung eines Datentyps
    @668[Simple-Variable              ] Variablenbeschreibungen
    @669[Array                        ] Beschreibungen von Feldern
    @670[Record                       ] Beschreibungen von Records
    @671[Variablenliste               ] Beschreibungen von Variablenlisten

    Jeder Objektgruppe ist zur Unterscheidung ein sogenannter "Object-Code"
    zugeordnet. Der Object-Code eines Objekts ist im Element "Object-Code" der
    Objektbeschreibung enthalten. D.h. mit Hilfe des Elements "Object-Code"
    kann die Objektgruppe (Domain, Program-Invocation, Event, Datentyp, usw.)
    eines Objekts ermittelt werden.
                                     @661[ Fortsetzung ]                   @001[ šbersicht ]
.661
    PROFIBUS-Library : Long-Version der Objektbeschreibung (Fortsetzung)

    Fordert man die Objektbeschreibung vom Index 0 (@662[Objekt Index 0]) an, so
    erh„lt man globale Informationen ber alle Objekte auf der Gegenstation.
    Beim Element "Namensl„nge" dieser Objektbeschreibung ist besondere Vorsicht
    geboten. Dieses Element gibt die L„nge des symbolischen Namens der Variable
    auf der Gegenstation an. Ist der symbolische Variablenname krzer als unter
    "Namensl„nge" angegeben, muá der symbolische Variablenname mit Leerzeichen
    auf die unter "Namensl„nge" angegeben L„nge aufgefllt werden.












    @650[ Objektverzeichnis ]                @550[ ANHANG ]                      @001[ šbersicht ]
.662
    PROFIBUS-Library : Objekt Index 0 (Long-Version)

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           RAM/ROM-Flag
            3                  BYTE           Namensl„nge (kurz "NL")
            4                  BYTE           Access-Protection-Supported
            5                  WORD           Version-OV
            7                  LONG           Local-Address-OV-OB
           11                  WORD           ST-OV-Length
           13                  LONG           Local-Address-ST-OV
           17                  WORD           First-Index-S-OV
           19                  WORD           S-OV-Length
           21                  LONG           Local-Address-S-OV
           25                  WORD           First-Index DV-OV
           27                  WORD           DV-OV-Length
           29                  LONG           Local-Address-DV-OV
           33                  WORD           First-Index-DP-OV
           35                  WORD           DP-OV-Length
           37                  LONG           Local-Address-DP-OV

    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.663
    PROFIBUS-Library : Domain (Long-Version)

    Object-Code: 2

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Max-Octets
            5                  BYTE           Password
            6                  BYTE           Access-Groups
            7                  WORD           Access-Rights
            9                  LONG           Local-Address
           13                  BYTE           Domain-State
           14                  BYTE           Upload-State
           15                  BYTE           Counter
           16                  BYTE           Name [NL]
           16+NL               BYTE           ext_len
           17+NL               BYTE           ext [ext_len]

    NL = Namensl„nge

    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.664
    PROFIBUS-Library : Program-Invocation (Long-Version)

    Object-Code: 3

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Domains (kurz "ND")
            4                  BYTE           Password
            5                  BYTE           Access-Groups
            6                  WORD           Access-Rights
            8                  BYTE           Deleteable
            9                  BYTE           Reusable
           10                  BYTE           PI-State
           11                  WORD           domain_index [ND]
           11+ND*2             BYTE           Name [NL]
           11+ND*2+NL          BYTE           ext_len
           12+ND*2+NL          BYTE           ext [ext_len]

    ND = Number-of-Domains, NL = Namensl„nge

    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.665
    PROFIBUS-Library : Event (Long-Version)

    Object-Code: 4

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Index-Event-Data
            5                  BYTE           Length
            6                  BYTE           Password
            7                  BYTE           Access-Groups
            8                  WORD           Access-Rights
           10                  BYTE           Enabled
           11                  BYTE           Name [NL]
           11+NL               BYTE           ext_len
           12+NL               BYTE           ext [ext_len]

    NL = Namensl„nge



    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.666
    PROFIBUS-Library : Datentyp (Long-Version)

    Object-Code: 5

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Name [NL]

    NL = Namensl„nge

    PROFIBUS stellt Standard-Datentypen zur Verfgung. Der Anwender hat jedoch
    auch die M”glichkeit, aus diesen Standard-Datentypen eine neue Daten-
    struktur aufzubauen, d.h. einen eigenen Datentyp zu definieren.







    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.667
    PROFIBUS-Library : Datentyp Strukturbeschreibung (Long-Version)

    Object-Code: 6

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Elements
            4                  WORD           Data-Type-Index(1)
            6                  BYTE           Length(1)
            7                  WORD           Data-Type-Index(2)
            9                  BYTE           Length(2)
           ...                 ...            ...
           3*NE+1              WORD           Data-Type-Index(NE)
           3*NE+3              BYTE           Length(NE)

    NE = Number-Of-Elements




    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.668
    PROFIBUS-Library : Simple-Variable (Long-Version)

    Object-Code: 7

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index
            5                  BYTE           Length
            6                  BYTE           Password
            7                  BYTE           Access-Groups
            8                  WORD           Access-Rights
           10                  LONG           Local-Address
           14                  BYTE           Name [NL]
           14+NL               BYTE           ext_len
           15+NL               BYTE           ext [ext_len]

    NL = Namensl„nge



    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.669
    PROFIBUS-Library : Array (Long-Version)

    Object-Code: 8

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index
            5                  BYTE           Length
            6                  BYTE           Number-Of-Elements
            7                  BYTE           Password
            8                  BYTE           Access-Groups
            9                  WORD           Access-Rights
           11                  LONG           Local-Address
           15                  BYTE           Name [NL]
           15+NL               BYTE           ext_len
           16+NL               BYTE           ext [ext_len]

    NL = Namensl„nge


    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.670
    PROFIBUS-Library : Record (Long-Version)

    Object-Code: 9

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index
            5                  BYTE           Password
            6                  BYTE           Access-Groups
            7                  WORD           Access-Rights
            9                  BYTE           Name [NL]
           9+NL                BYTE           ext_len
           10+NL               BYTE           ext [ext_len]
           10+NL+EL            LONG           local-Address [Anzahl-Komponenten]

    NL = Namensl„nge, EL = ext_len
    Liegen die Komponenten des Records dicht hintereinander, wird nur die
    "local-Address" der ersten Komponente bertragen. Ansonsten muá die
    "Anzahl-Komponenten" implizit bekannt sein.

    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.671
    PROFIBUS-Library : Variablenliste (Long-Version)

    Object-Code: 10

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Elements (kurz "NE")
            4                  BYTE           Password
            5                  BYTE           Access-Groups
            6                  WORD           Access-Rights
            8                  BYTE           Deleteable
            9                  WORD           Element-Index [NE]
           9+NE*2              BYTE           Name [NL]
           9+NE*2+NL           BYTE           ext_len
           12+NE*2+NL          BYTE           ext [ext_len]

    NE = Number-Of-Elements, NL = Namensl„nge



    @660[ Long-Version ]                @650[ Objektverzeichnis ]                @001[ šbersicht ]
.680
    PROFIBUS-Library : Short-Version der Objektbeschreibung

    Die einzelnen Objekte einer Station sind in Objektgruppen (Domain, Program-
    Invocation, Event, Datentyp, usw.) zusammengefaát. Die Objektbeschreibung
    ist fr jede Objektgruppe unterschiedlich aufgebaut:

    @683[Domain                       ] Beschreibungen von Speicherbereichen
    @684[Program-Invocation           ] Programmbeschreibungen
    @685[Event                        ] Eventbeschreibungen
    @686[Datentyp                     ] Datentypbeschreibungen
    @687[Datentyp Strukturbeschreibung] Strukturbeschreibung eines Datentyps
    @688[Simple-Variable              ] Variablenbeschreibungen
    @689[Array                        ] Beschreibungen von Feldern
    @690[Record                       ] Beschreibungen von Records
    @691[Variablenliste               ] Beschreibungen von Variablenlisten

    Jeder Objektgruppe ist zur Unterscheidung ein sogenannter "Object-Code"
    zugeordnet. Der Object-Code eines Objekts ist im Element "Object-Code" der
    Objektbeschreibung enthalten. D.h. mit Hilfe des Elements "Object-Code"
    kann die Objektgruppe (Domain, Program-Invocation, Event, Datentyp, usw.)
    eines Objekts ermittelt werden.
                                     @681[ Fortsetzung ]                   @001[ šbersicht ]
.681
    PROFIBUS-Library : Short-Version der Objektbeschreibung (Fortsetzung)

    Fordert man die Objektbeschreibung vom Index 0 (@682[Objekt Index 0]) an, so
    erh„lt man globale Informationen ber alle Objekte auf der Gegenstation.
    Beim Element "Namensl„nge" dieser Objektbeschreibung ist besondere Vorsicht
    geboten. Dieses Element gibt die L„nge des symbolischen Namens der Variable
    auf der Gegenstation an. Ist der symbolische Variablenname krzer als unter
    "Namensl„nge" angegeben, muá der symbolische Variablenname mit Leerzeichen
    auf die unter "Namensl„nge" angegeben L„nge aufgefllt werden.












    @650[ Objektverzeichnis ]                @550[ ANHANG ]                      @001[ šbersicht ]
.682
    PROFIBUS-Library : Objekt Index 0 (Short-Version)

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           RAM/ROM-Flag
            3                  BYTE           Namensl„nge (kurz "NL")
            4                  BYTE           Access-Protection-Supported
            5                  WORD           Version-OV













    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.683
    PROFIBUS-Library : Domain (Short-Version)

    Object-Code: 2

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Max-Octets













    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.684
    PROFIBUS-Library : Program-Invocation (Short-Version)

    Object-Code: 3

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Domains (kurz "ND")













    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.685
    PROFIBUS-Library : Event (Short-Version)

    Object-Code: 4

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Index-Event-Data
            5                  BYTE           Length












    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.686
    PROFIBUS-Library : Datentyp (Short-Version)

    Object-Code: 5

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code

    PROFIBUS stellt Standard-Datentypen zur Verfgung. Der Anwender hat jedoch
    auch die M”glichkeit, aus diesen Standard-Datentypen eine neue Daten-
    struktur aufzubauen, d.h. einen eigenen Datentyp zu definieren.










    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.687
    PROFIBUS-Library : Datentyp Strukturbeschreibung (Short-Version)

    Object-Code: 6

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Elements
            4                  WORD           Data-Type-Index(1)
            6                  BYTE           Length(1)
            7                  WORD           Data-Type-Index(2)
            9                  BYTE           Length(2)
           ...                 ...            ...
           3*NE+1              WORD           Data-Type-Index(NE)
           3*NE+3              BYTE           Length(NE)

    NE = Number-Of-Elements




    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.688
    PROFIBUS-Library : Simple-Variable (Short-Version)

    Object-Code: 7

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index
            5                  BYTE           Length












    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.689
    PROFIBUS-Library : Array (Short-Version)

    Object-Code: 8

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index
            5                  BYTE           Length
            6                  BYTE           Number-Of-Elements











    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.690
    PROFIBUS-Library : Record (Short-Version)

    Object-Code: 9

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  WORD           Data-Type-Index













    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.691
    PROFIBUS-Library : Variablenliste (Short-Version)

    Object-Code: 10

    Offset in Bytes   L„nge der Information   Information
            0                  WORD           Index
            2                  BYTE           Object-Code
            3                  BYTE           Number-Of-Elements (kurz "NE")













    @680[ Short-Version ]               @650[ Objektverzeichnis ]                @001[ šbersicht ]
.700
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000

    Der Zugriff auf Variablen mittels PROFIBUS kann ber verschiedene Arten
    der Adressierung erfolgen. Dabei kann "per Name", "per Index" oder
    "per physical Address" zugegriffen werden. Es wird davon ausgegangen,
    daá sich bei jeder Adressierung hinter dem gegebenen Adreá-Parameter
    eine einziges Objekt eines bestimmten Typs befindet.

    Die Programmierung des SYSTEM 2000 erfolgt auf symbolischer Ebene. Alle
    in Anwender-Tasks verwendeten Variablen sind dabei als Kommunikations-
    objekte ansprechbar. Sobald eine Task auf die Steuerung geladen wird,
    sind alle darin verwendeten Variablen ber das Netzwerk als PROFIBUS-
    Objekte ansprechbar. Die zugeh”rigen Indizes werden allerdings von der
    RPS zum Zeitpunkt des Entstehens eines Objekts vergeben.

    Die damit verbundene Problematik besteht darin, das der Index eines
    Objekts nicht vordefiniert werden kann, sondern von gewissen Faktoren
    abh„ngig ist.



    @701[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.701
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000 (Fortsetzung)

    Im allgemeinen kann der Index ber einen Get-OV-Dienst ermittelt werden.
    Auf diese Weise wird beispielsweise bei PANELWARE und INTERACT vorge-
    gegangen. Das ist aber nicht in jedem System m”glich, weil der Get-OV-
    Dienst nicht immer implementiert ist. Der Dienst Read-per-Name steht
    ebenfalls nicht immer zur Verfgung und ben”tigt auáerdem zur Beantwortung
    l„nger und beansprucht die System-Ressourcen der Steuerung intensiver.

    Um in diesem Fall trotzdem den Zugriff per Index zu erm”glichen, muá der
    Algorithmus bei der Vergabe der Indizes bekannt sein. Auf diese Art kann
    dann fr jede beliebige Variable der zugeh”rige Index ermittelt werden.









    @702[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.702
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000 (Fortsetzung)

    Startindex fr Variablen:

    Die Variablen liegen alle in einem bestimmten vordefinierten Bereich des
    Objektverzeichnisses. Dieser Bereich wird durch einen Index fr den
    Beginn und einen fr das Ende charakterisiert (siehe Objektverzeichnis
    SYSTEM 2000). Einer Variablen wird nun ein bestimmter Index, und zwar
    immer nur aus diesem Bereich, zugeteilt. Sind alle Indizes vergeben,
    k”nnen fr weitere Variablen keine Objektbeschreibungen mehr angelegt
    werden. Diese Variablen sind nicht mehr ber das Netzwerk zug„nglich.
    Der Startindex fr den Bereich "Prozeávariable" ist standardm„áig auf $0B00
    gelegt. Dieser Wert kann mit dem PG2000 (in der Systemkonfiguration) ge-
    „ndert werden. Dazu rufen Sie die Funktion <Objekt><Parameter> aus der
    Task-Ebene der GDM auf. Der Cursor muá sich dabei auf dem "sysconf"-Symbol
    befinden. Anschlieáend k”nnen Sie durch Anwahl der Funktion <PB Indizes>
    (siehe Popup-Men des Feldes <Konfiguriere>) eine Dialogbox zum Festlegen
    der Indizes fr die PROFIBUS-Objekte ”ffnen.
    Mit den Parametern fr "Prozeávariable" kann der Bereich der Indizes fr
    Variablen eingestellt werden.

    @703[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.703
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000 (Fortsetzung)

    Vergabe der Indexbereiche fr Tasks:

    Fr jede Task werden zuerst einmal 256 Indizes reserviert. Reichen diese
    nicht aus, werden weitere 256 Indizes vergeben, bis alle Variablen zuge-
    ordnet sind. Dabei ist die Reihenfolge, in der die Tasks installiert
    werden, ausschlaggebend fr den zugewiesenen Indexbereich. So bekommt
    die erste Task die Indizes $0B00 bis $0BFF, die zweite $0C00 bis $0CFF
    usw. Sind die Tasks bereits auf der RPS und werden durch einen WARMSTART
    (alte Bezeichnung: INIT) bzw. KALTSTART (alte Bezeichnung: TOTALINIT)
    neu gestartet, so ist die Ablaufreihenfolge abh„ngig von den (in den
    Taskparametern) eingestellten Start-Nummern. Im Fall eines Downloads
    werden die Tasks natrlich in der Download-Reihenfolge gestartet.







    @704[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.704
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000 (Fortsetzung)

    Vergabe der Indizes fr Variablen in einer Task:

    Innerhalb des Indexbereiches von 256 oder mehr Bytes werden die Variablen
    nach einem bestimmten Algorithmus gereiht. Folgende Regeln sind dabei zu
    beachten:

    - Die Variablen werden nach der L„nge ihres Namens gereiht. Dabei werden
      l„ngere Namen immer vor den krzeren plaziert.

    - Gleich lange Namen werden alphabetisch gereiht und zwar in umgekehrter
      Reihenfolge. D.h. die Variable BB kommt vor der Variable AA.

    - Fr jede einzelne Variable wird genau ein Index vergeben. Fr Strukturen
      und Felder (Arrays) werden zwei Indizes vergeben.





    @705[ Fortsetzung ]                      @550[ ANHANG ]                      @001[ šbersicht ]
.705
    PROFIBUS-Library : PROFIBUS-Indizes im SYSTEM 2000 (Fortsetzung)

    Vorgangsweise am PG2000:

    Alle Variablen, die fr die Kommunikation ben”tigt werden, sollen sich in
    einer Task befinden. Fr diese Variablen kann durch die Namensgebung die
    Reihenfolge fr die Indexvergabe festgelegt werden. Bei den Taskparametern
    (Objektparametern) ist fr die Start-Nummer der Wert 1 einzutragen. Somit
    wird diese Task bei einem Hochlauf der RPS als erste gestartet und erh„lt
    immer die Indizes von $0B00 aufsteigend. Bei einem Download muá ebenfalls
    sichergestellt werden, daá diese Task immer als erste gestartet wird.
    Somit k”nnen mit dem oben angegebenen Algorithmus die Indizes bestimmt
    werden. Bei einer nachtr„glichen nderung von Variablen in der Task ist zu
    beachten, daá sich bei entsprechender Namenswahl Verschiebungen ergeben
    k”nnen.






                                       @550[ ANHANG ]                      @001[ šbersicht ]
.750
    PROFIBUS-Library : Syntaxbeschreibung

    Datentypen:
    Fr viele Funktionen sind bestimmte Gruppen von Datentypen zul„ssig. Um
    bei der Funktionsbeschreibung nicht alle zul„ssigen Datentypen anfhren
    zu mssen, werden folgende Gruppenbezeichnungen eingefhrt:
    ÉÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍ»
    º Gruppe º  BIT  ³ INT8  ³ BYTE  ³ INT16 ³ WORD  ³ INT32 ³ LONG  ³ FLOAT º
    ÌÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍ¹
    º BASIS  º       ³   x   ³   x   ³   x   ³   x   ³   x   ³   x   ³       º
    ÇÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ¶
    º NICHT  º   x   ³   x   ³   x   ³   x   ³   x   ³   x   ³   x   ³       º
    º FLOAT  º       ³       ³       ³       ³       ³       ³       ³       º
    ÇÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ¶
    º ALLE   º   x   ³   x   ³   x   ³   x   ³   x   ³   x   ³   x   ³   x   º
    ÇÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ¶
    º FELD   º  [x]  ³  [x]  ³  [x]  ³  [x]  ³  [x]  ³  [x]  ³  [x]  ³  [x]  º
    ÈÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍ¼
      x  Datentyp ist zul„ssig
     [x] Datentyp ist zul„ssig als Feldvariable oder Zeichenkette (String)

                                     @751[ Fortsetzung ]                   @001[ šbersicht ]
.751
    PROFIBUS-Library : Syntaxbeschreibung (Fortsetzung)

    Pfeile:
    Fr die Darstellung von Eingangs- und Ausgangsparametern werden Pfeile
    verwendet. Dabei gilt folgende Vereinbarung:
    ÉÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
    º  Pfeil  º  Bedeutung                                                   º
    ÌÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
    º   ->    º  Eingangsparameter                                           º
    ÇÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
    º   <->   º  Ein-/Ausgangsparameter. Funktionell ist es ein Ausgangs-    º
    º         º  parameter. šblicherweise wird er aber vor dem Aufruf der    º
    º         º  Funktion mit einer bestimmten Information geladen (z.B.     º
    º         º  einer Adresse). Meist wird die Adresse einer Variable mit   º
    º         º  adr() [PL2000] oder einem Adreákontakt [KOP] angeschlossen. º
    ÇÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
    º   <-    º  Ausgangsparameter                                           º
    ÈÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼



                                     @752[ Fortsetzung ]                   @001[ šbersicht ]
.752
    PROFIBUS-Library : Syntaxbeschreibung (Fortsetzung)

    Funktionsbl”cke:
    Funktionsbl”cke sind in dieser Online-Hilfe nicht grafisch dargestellt.
    Sie finden aber alle fr Funktionsbl”cke relevanten Informationen, wie
    Eingangsparameter (->), Ein-/Ausgangsparameter (<->) und Ausgangsparameter
    (<-) in der Online-Hilfe.














                                       @550[ ANHANG ]                      @001[ šbersicht ]
.800
    PROFIBUS-Library : Fehlernummern

    Die folgende Liste ist eine Zusammenfassung aller m”glichen Fehlermeldungen
    der PROFIBUS-Library:

    4000    Device-Nummer existiert nicht
    4002    Kein Puffer frei fr Funktion (im PBinit() wurde "srv_cnt" zu gering
            angegeben). Dieser Fehler kann auch beim Reload eines BR-Moduls mit
            PROFIBUS-Funktionen auftreten (Abhilfe: WARMSTART ausl”sen).
    4011    Verbindungsnummer existiert nicht
    4012    Verbindung ist inaktiv
    4014    Verbindung ist nicht ansprechbar
    4801    Falsche Verbindungsnummer
    4855    WARMSTART wurde ausgel”st
    4860    Fehler 1 bei der Dienstabwicklung
    4861    Fehler 2 bei der Dienstabwicklung
    4862    Fehler 3 bei der Dienstabwicklung
    4863    Fehler 4 bei der Dienstabwicklung
    4864    Die empfangene Datenl„nge ist gr”áer als der reservierte Datenpuffer
    4865    Error Response wurde empfangen

                                     @801[ Fortsetzung ]                   @001[ šbersicht ]
.801
    PROFIBUS-Library : Fehlernummern (Fortsetzung)

    4866    Falsche "spec_id" vom User
    4867    Dienst wird nicht untersttzt
    4868    Fehler beim Senden eines unbest„tigten (unconfirmed) Dienstes auf-
            getreten
    4869    Es wurde eine PROFIBUS-Funktion aufgerufen, obwohl zuvor kein
            PBinit-Aufruf durchgefhrt wurde
    4870    Auftragsverwaltungsfehler 1 aufgetreten
    4871    Auftragsverwaltungsfehler 2 aufgetreten
    4872    Auftragsverwaltungsfehler 3 aufgetreten
    4873    Auftragsverwaltungsfehler 4 aufgetreten
    4874    Bei PBgetOVM() wurden zuwenig Feldelemente mitgegeben
    4875    Verbindung ist nicht VB orientiert (Fehler bei PBconn)
    4876    Auf eine AUTO Verbindung wurde ein Connect oder Abort durchgefhrt
    4877    Verbindung ist bereits auf AUTO
            (ein weiterer Connect wurde ausgel”st)
    4878    Verbindung ist nicht abgebaut und Connect-Aufruf vom Anwender
    4879    Ungltiges Kommando wurde gegeben
    4880    PBinit() wurde ein zweites Mal aufgerufen

                                     @802[ Fortsetzung ]                   @001[ šbersicht ]
.802
    PROFIBUS-Library : Fehlernummern (Fortsetzung)

    4881    PBinit() untersttzt derzeit noch keine Zusatzparameter
    4882    Verbindung ist fr PROFIBUS-Funktionen nicht verwendbar (falsches
            Device)
    4883    Angegebene Verbindung geht auf ein anderes Device
    4884    Eine Funktion wurde aufgerufen, obwohl PBinit() noch nicht aktiv war
    4885    šbergebener Name ist zu lang
    4886    PBinit(): Konfigmodul enth„lt kein Netzwerk-Device
    4887    Fehler beim Anfordern eines Puffers
    4888    Rsync oder Ssync Ptr ist NULL-Pointer
    4889    Reject: Es wurden zu viele parallele Services auf einer Verbindung
            aktiviert
    4890    Auf einer Verbindung darf gleichzeitig nur ein Download abgewickelt
            werden (wird ein zweiter angestoáen, kommt diese Fehlermeldung)
    4891    Fehler bei der Abwicklung eines Download; (DL Statemaschine wartete
            nicht auf eine TERMDL_Response)
    4892    Download ist gerade aktiv! TerminateDL wird gesendet
    4893    State Konflikt beim Download
    4894    Mit PBrec() wurde ein ungltiger Dienst empfangen

                                     @803[ Fortsetzung ]                   @001[ šbersicht ]
.803
    PROFIBUS-Library : Fehlernummern (Fortsetzung)

    4895    Falsche L„nge beim Download angegeben
    4896    Terminate Download im Download-Vorgang empfangen
    4897    Gegenstation meldet: Final Result 0 (=Error)
    4923    PBsend(): Parameter ungltig
    4924    PBsend(): Betriebsmittel der lokalen FDL Steuerung nicht verfgbar
            oder nicht ausreichend
    4925    PBsend(): Source-SAP (lokaler SAP) ist fr den gewnschten Dienst
            nicht konfiguriert
    4926    PBsend(): SAP ist bereits konfiguriert
    4927    PBsend(): Die lokale Station ist nicht im logischen Token-Ring
    4928    PBsend(): Keine oder keine plausible Reaktion der Remote-Station
    4931    PBsend(): Negative Quittung (Remote User/FDL Schnittstellenfehler)
    4932    PBsend(): Negative Quittung (Betriebsmittel der Remote-FDL
            Steuerung nicht verfgbar oder nicht ausreichend)
    4933    PBsend(): Dienst oder Remote-Adresse beim Destination-SAP
            (remote SAP) nicht aktiviert
    4939    PBsend(): Positive Quittung fr Sendedaten; Negative Quittung fr
            Empfangsdaten (da bei Remote-Station nicht vorhanden)

                                     @804[ Fortsetzung ]                   @001[ šbersicht ]
.804
    PROFIBUS-Library : Fehlernummern (Fortsetzung)

    4942    PBsend(): Negative Quittung fr Sendedaten (da Betriebsmittel der
            Remote-Station nicht verfgbar oder nicht ausreichend)

















                                       @550[ ANHANG ]                      @001[ šbersicht ]
.900
    PROFIBUS-Library : History - Versions„nderungen

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º V3.00 -> V3.20  ³ AKTUELLE VERSION: Neue Funktionalit„ten/Fehlerbehebung  º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º Folgende Fehler wurden behoben:                                           º
  º - Bei speziellen PROFIBUS-Konfigurationen kann ein Bus-Error in den       º
  º   PROFIBUS-FUBs auftreten.                                                º
  º - Bei der Initialisierung der PROFIBUS-FUBs k”nnen (abh„ngig von der      º
  º   Speicherverteilung im DPR) falsche Adressen berechnet werden, die dann  º
  º   zu einem Bus-Error fhren.                                              º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º V2.02 -> V3.00  ³ LTERE VERSIONEN: Neue Funktionalit„ten/Fehlerbehebung  º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º Fr Betriebssystem-Versionen gr”áer V1.91 muá diese Version der PROFIBUS- º
  º Library verwendet werden.                                                 º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼




                                     @901[ Fortsetzung ]                   @001[ šbersicht ]
.901
    PROFIBUS-Library : History - Versions„nderungen (Fortsetzung)

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º V2.01 -> V2.02  ³ LTERE VERSIONEN: Neue Funktionalit„ten/Fehlerbehebung  º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º Nicht verwendete SAP-Listen werden ignoriert. Bei „lteren Versionen trat  º
  º in diesem Fall der Fehler 3000 auf.                                       º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º V2.00 -> V2.01  ³ LTERE VERSIONEN: Neue Funktionalit„ten/Fehlerbehebung  º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º - PROFIBUS-FDL-Dienste implementiert.                                     º
  º - Folgende M„ngel wurden behoben:                                         º
  º    - Fehler 4926 nicht dokumentiert                                       º
  º    - Reply Update Doku                                                    º
  º    - Fehler 4855 mehrdeutig                                               º
  º - Keine L7-Dienste nach einem L2-Dienst am selben APB m”glich (dies gilt  º
  º   sowohl fr die PC-Firmware als auch fr die NW100/NW150-Firmware).      º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼



                                     @902[ Fortsetzung ]                   @001[ šbersicht ]
.902
    PROFIBUS-Library : History - Versions„nderungen (Fortsetzung)

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º V1.10 -> V2.00  ³ LTERE VERSIONEN                                        º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º PROFIBUS-FDL-Dienste implementiert.                                       º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º V1.10           ³ LTERE VERSIONEN                                        º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º Erste Version der PROFIBUS-Library.                                       º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼










                                       @550[ ANHANG ]                      @001[ šbersicht ]

.End
